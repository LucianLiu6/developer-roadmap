import{j as e}from"./jsx-runtime.CAnB4H9Z.js";import{r as a}from"./index.qVDZzPEr.js";import{D as $}from"./index.es.B1RiJbf6.js";/* empty css                       */import{u as F}from"./use-outside-click.DwmohMvh.js";import{u as _}from"./use-keydown.DHXzDwpw.js";import{b as L}from"./http.DleWH6fe.js";import{t as N}from"./resource-progress.D0zUEWjd.js";import{g as q,d as P}from"./browser.t5_cZ6DD.js";import{u as O}from"./use-auth.BGqQ_BxX.js";import{E as J}from"./ErrorIcon.CCewPpbl.js";import{S as B}from"./Spinner.xsriOokz.js";import{X as H}from"./x.BPEozwHq.js";function z(d,t){console.warn("renderFlowJSON is not implemented"),console.warn("run the following command to generate the renderer:"),console.warn("> npm run generate-renderer")}function G(d){const{isLoading:t,text:n,error:p}=d;return e.jsx("div",{className:"fixed left-0 right-0 top-0 z-[100] h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e.jsx("div",{className:"relative mx-auto flex h-full w-full items-center justify-center",children:e.jsx("div",{className:"popup-body relative rounded-lg bg-white p-5 shadow",children:e.jsxs("div",{className:"flex items-center",children:[t&&e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-6 w-6",isDualRing:!1}),e.jsx("span",{className:"ml-3 text-lg font-semibold",children:n||"Loading..."})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx(J,{additionalClasses:"h-6 w-6 text-red-500"}),e.jsx("span",{className:"ml-3 text-lg font-semibold",children:p})]})]})})})})}function V(d){const{isLoading:t,progressResponse:n}=d,p=n?.user,l=n?.progress,u=l?.total||0,r=l?.done?.length||0,h=Math.round(r/u*100)||0,f=l?.learning?.length||0,g=l?.skipped?.length||0;return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-5 mt-0 min-h-[28px] text-left sm:text-center md:mt-4 md:h-[60px]",children:[e.jsxs("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:[p?.name,"'s Progress"]}),e.jsx("p",{className:"hidden text-xs text-gray-500 sm:text-sm md:block md:text-base",children:"You can close this popup and start tracking your progress."})]}),e.jsxs("p",{className:"-mx-4 mb-3 flex items-center justify-start border-b border-t px-4 py-2 text-sm sm:hidden",children:[e.jsxs("span",{className:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:h}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:r})," of ",e.jsx("span",{children:u})," done"]})]}),e.jsxs("p",{className:`-mx-4 mb-3 hidden items-center justify-center border-b border-t py-2 text-sm sm:flex ${t?"striped-loader":""}`,children:[e.jsxs("span",{className:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:h}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:r})," completed"]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:f})," in progress"]}),g>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:g})," skipped"]})]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:u})," Total"]})]})]})}function le(d){const{resourceId:t,resourceType:n,userId:p,onClose:l,renderer:u="balsamiq"}=d,{s:r=p}=q();if(!r)return null;const h=a.useRef(null),f=a.useRef(null),g=O(),[k,R]=a.useState(!!r),[U,I]=a.useState(null),[M,A]=a.useState(),[b,E]=a.useState(!0),[v,y]=a.useState("");let j="https://roadmap.sh";n==="roadmap"?j+=`/${t}.json`:j+=`/best-practices/${t}.json`;async function C(s,i,m){const{error:c,response:w}=await L(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-get-user-progress/${s}?resourceType=${i}&resourceId=${m}`);if(c||!w)throw c||new Error("Something went wrong. Please try again!");return w}async function D(s,i="balsamiq"){const{error:m,response:c}=await L(s);if(m||!c)throw m||new Error("Something went wrong. Please try again!");return i==="editor"?await z():await $(c,{fontURL:"/fonts/balsamiq.woff2"})}function S(){P("s"),y(""),R(!1),l?l():window.location.reload()}return _("Escape",()=>{S()}),F(f,()=>{S()}),a.useEffect(()=>{!j||!t||!n||!r||(E(!0),y(""),Promise.all([D(j,u),C(r,n,t)]).then(([s,i])=>{if(!i||!s)return;const{progress:m}=i,{done:c,learning:w,skipped:T}=m||{done:[],learning:[],skipped:[]};c?.forEach(o=>{N(o,s).forEach(x=>{x.classList.add("done")})}),w?.forEach(o=>{N(o,s).forEach(x=>{x.classList.add("learning")})}),T?.forEach(o=>{N(o,s).forEach(x=>{x.classList.add("skipped")})}),s.querySelectorAll(".clickable-group").forEach(o=>{o.classList.remove("clickable-group")}),s.querySelectorAll("[data-group-id]").forEach(o=>{o.removeAttribute("data-group-id")}),I(s),A(i)}).catch(s=>{y(s?.message||"Something went wrong. Please try again!")}).finally(()=>{E(!1)}))},[r]),g?.id===r?(P("s"),null):k?b||v?e.jsx(G,{text:"Loading user progress..",isLoading:b,error:v}):e.jsx("div",{id:"user-progress-modal",className:"fixed left-0 right-0 top-0 z-[100] h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e.jsx("div",{className:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e.jsxs("div",{ref:f,className:"popup-body relative rounded-lg bg-white pt-[1px] shadow",children:[e.jsx(V,{isLoading:b,progressResponse:M}),e.jsx("div",{ref:h,className:"px-4 pb-2",dangerouslySetInnerHTML:{__html:U?.outerHTML||""}}),e.jsxs("button",{type:"button",className:"absolute right-2.5 top-3 ml-auto inline-flex items-center rounded-lg bg-gray-100 bg-transparent p-1.5 text-sm text-gray-400 hover:text-gray-900 lg:hidden",onClick:S,children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close modal"})]})]})})}):null}export{G as M,V as U,le as a};
