import{j as e}from"./jsx-runtime.CAnB4H9Z.js";import{r as p}from"./index.qVDZzPEr.js";import{b as C}from"./http.DleWH6fe.js";import{p as T}from"./page.BgB1PChG.js";import{u as y}from"./index.BVW7W7Ao.js";import{a as w}from"./team.BdQJIqcX.js";import{c as N}from"./classname.BR_JCrAi.js";import{u as _}from"./use-toast.CP_0jytG.js";import{g as R,s as A}from"./browser.t5_cZ6DD.js";import{u as P}from"./use-auth.BGqQ_BxX.js";import{E as M}from"./external-link.CkKSvBqf.js";import{M as k,a as $}from"./MemberCustomProgressModal.C2RGGv0i.js";import"./jwt.CBjnGchD.js";import"./index.DgoachrA.js";import"./index.BRGkBvr2.js";import"./toast.CxFvZIRu.js";import"./createLucideIcon.BiEhg7VK.js";import"./index.es.B1RiJbf6.js";import"./Spinner.xsriOokz.js";/* empty css                       */import"./use-outside-click.DwmohMvh.js";import"./use-keydown.DHXzDwpw.js";import"./resource-progress.D0zUEWjd.js";import"./roadmap.BEsVk7__.js";import"./dom.DTPLKm7E.js";import"./x.BPEozwHq.js";import"./readonly-editor.DRQmhAvb.js";function L(i){const{member:o,onShowResourceProgress:d,isMyProgress:h=!1,teamId:f}=i,g=y(w),l=o?.progress?.sort((s,t)=>t.done-s.done),[a,u]=p.useState(!1),n=g?.personalProgressOnly&&g.role==="member"&&String(o._id)!==g.memberId,x=`/team/member?t=${f}&m=${o._id}`;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-full min-h-[270px] flex-col overflow-hidden rounded-md border",children:[e.jsxs("div",{className:"relative flex items-center gap-3 border-b p-3",children:[e.jsx("img",{src:o.avatar?`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_AVATAR_BASE_URL}/${o.avatar}`:"/images/default-avatar.png",alt:o.name||"",className:"h-8 min-h-[32px] w-8 min-w-[32px] rounded-full"}),e.jsxs("div",{className:"inline-grid w-full",children:[!h&&e.jsx("a",{href:x,className:N("truncate font-medium",n?"pointer-events-none cursor-default no-underline":""),onClick:s=>{n&&s.preventDefault()},"aria-disabled":n,children:o.name}),h&&e.jsxs("div",{className:"inline-grid grid-cols-[auto,32px] items-center gap-1.5",children:[e.jsx("a",{href:x,className:N("truncate font-medium",n?"pointer-events-none cursor-default no-underline":""),onClick:s=>{n&&s.preventDefault()},"aria-disabled":n,children:o.name}),e.jsx("span",{className:"rounded-md bg-red-500 px-1 py-0.5 text-xs text-white",children:"You"})]}),e.jsx("p",{className:"truncate text-sm text-gray-500",children:o.email})]})]}),e.jsxs("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(a?l:l.slice(0,4)).map(s=>e.jsxs("button",{onClick:()=>d(s.resourceId,s.isCustomResource),className:"group relative overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-none",children:[e.jsxs("span",{className:"relative z-10 flex items-center justify-between text-sm",children:[e.jsx("span",{className:"inline-grid",children:e.jsx("span",{className:"truncate",children:s.resourceTitle})}),e.jsxs("span",{className:"ml-1.5 shrink-0 text-xs text-gray-400",children:[s.done," / ",s.total]})]}),e.jsx("span",{className:"absolute inset-0 bg-gray-100 group-hover:bg-gray-200",style:{width:`${s.done/s.total*100}%`}})]},s.resourceId)),l.length>4&&!a&&e.jsxs("button",{onClick:()=>u(!0),className:"text-sm text-gray-400 underline",children:["+ ",l.length-4," more"]}),a&&e.jsx("button",{onClick:()=>u(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),l.length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"No progress"})]})]},o._id)})}function D(i){const{onShowResourceProgress:o}=i,{members:d,resourceTitle:h,resourceId:f,isCustomResource:g,roadmapSlug:l}=i.roadmap,{t:a}=R(),u=P(),[n,x]=p.useState(!1),s=g?`/r/${l}`:`/${f}?t=${a}`;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-full min-h-[270px] flex-col rounded-md border",children:[e.jsx("div",{className:"flex items-center gap-3 border-b p-3",children:e.jsxs("div",{className:"flex min-w-0 flex-grow items-center justify-between",children:[e.jsx("h3",{className:"truncate font-medium",children:h}),e.jsx("a",{href:s,className:"group mb-0.5 flex shrink-0 items-center justify-between text-base font-medium leading-none text-black",target:"_blank",children:e.jsx(M,{className:"h-4 w-4 opacity-20 transition-opacity group-hover:opacity-100"})})]})}),e.jsxs("div",{className:"relative flex grow flex-col space-y-2 p-3",children:[(n?d:d.slice(0,4)).map(t=>{const b=u?.email===t?.member?.email;return t.progress?e.jsxs("button",{className:`group relative w-full overflow-hidden rounded-md border p-2 hover:border-gray-300 hover:text-black focus:outline-none ${b?"border-green-500 hover:border-green-600":""}`,onClick:()=>{o(t.member,t.progress?.resourceId)},children:[e.jsxs("span",{className:"relative z-10 flex items-center justify-between gap-1 text-sm",children:[e.jsxs("span",{className:"inline-grid grid-cols-[20px_auto] gap-3",children:[e.jsx("img",{src:t.member.avatar?`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_AVATAR_BASE_URL}/${t.member.avatar}`:"/images/default-avatar.png",alt:t.member.name||"",className:"h-5 w-5 shrink-0 rounded-full"}),e.jsx("span",{className:"inline-grid grid-cols-[auto,32px] items-center",children:e.jsx("span",{className:"mr-[5px] truncate",children:t?.member?.name})})]}),e.jsxs("span",{className:"shrink-0 text-xs text-gray-400",children:[t?.progress?.done," / ",t?.progress?.total]})]}),e.jsx("span",{className:`absolute inset-0 ${b?"bg-green-100 group-hover:bg-green-200":"bg-gray-100 group-hover:bg-gray-200"}`,style:{width:`${t?.progress?.done/t?.progress?.total*100}%`}})]},t?.member._id):null}),d.length>4&&!n&&e.jsxs("button",{onClick:()=>x(!0),className:"text-sm text-gray-400 underline",children:["+ ",d.length-4," more"]}),n&&e.jsx("button",{onClick:()=>x(!1),className:"text-sm text-gray-400 underline",children:"- Show less"}),d.length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"No progress"})]})]})})}const U=[{label:"Members",value:"member"},{label:"Roadmaps",value:"roadmap"}];function ue(){const{t:i,gb:o}=R(),[d,h]=p.useState(!0),f=_(),g=y(w),l=P(),[a,u]=p.useState(),[n,x]=p.useState([]),[s,t]=p.useState(o||"member");async function b(){const{response:r,error:c}=await C(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-get-team-progress/${i}`);if(c||!r){f.error(c?.message||"Failed to get team progress");return}x(r.sort((m,j)=>m.email===l?.email?-1:j.email===l?.email?1:0))}p.useEffect(()=>{i&&b().then(()=>{T.set(""),h(!1)})},[i]),p.useEffect(()=>{s&&A({gb:s})},[s]);const S=[];for(const r of g?.roadmaps||[]){let c=!1;const m=[];for(const j of n){const v=j.progress.find(E=>E.resourceId===r);v&&(v.isCustomResource&&!c&&(c=!0),m.push({member:j,progress:v}))}m.length&&S.push({resourceId:r,resourceTitle:m?.[0].progress?.resourceTitle||"",resourceType:"roadmap",roadmapSlug:m?.[0].progress?.roadmapSlug,members:m,isCustomResource:c})}if(!i){window.location.href="/";return}if(d)return null;const I=a&&!a.isCustomResource?k:$;return e.jsxs("div",{children:[a&&e.jsx(I,{member:a.member,teamId:i,resourceId:a.resourceId,resourceType:"roadmap",isCustomResource:a.isCustomResource,onClose:()=>{u(void 0)},onShowMyProgress:()=>{u({resourceId:a.resourceId,member:n.find(r=>r.email===l?.email),isCustomResource:a.isCustomResource})}}),e.jsx("div",{className:"flex items-center gap-2",children:U.map(r=>e.jsx("button",{className:`rounded-md border p-1 px-2 text-sm ${s===r.value?" border-gray-400 bg-gray-200 ":""}`,onClick:()=>t(r.value),children:r.label},r.value))}),e.jsxs("div",{className:"mt-6",children:[s==="roadmap"&&e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:S.map(r=>e.jsx(D,{roadmap:r,onShowResourceProgress:(c,m)=>{u({resourceId:m,member:c,isCustomResource:r.isCustomResource})}},r.resourceId))}),s==="member"&&e.jsx("div",{className:"grid gap-4 sm:grid-cols-2",children:n.map(r=>e.jsx(L,{member:r,teamId:i,isMyProgress:r?.email===l?.email,onShowResourceProgress:(c,m)=>{u({resourceId:c,member:r,isCustomResource:m})}},r._id))})]})]})}export{ue as TeamProgressPage};
