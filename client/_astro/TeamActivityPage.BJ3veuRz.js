import{j as e}from"./jsx-runtime.CAnB4H9Z.js";import{r as x}from"./index.qVDZzPEr.js";import{u as I}from"./use-toast.CP_0jytG.js";import{g as _}from"./browser.t5_cZ6DD.js";import{b as $}from"./http.DleWH6fe.js";import{p as S}from"./page.BgB1PChG.js";import{g as D}from"./date.4SaMaFlQ.js";import{A as w,C as E,a as R,B as U}from"./ActivityTopicTitles.CitEaLKA.js";import{c as P}from"./classname.BR_JCrAi.js";import{u as L}from"./index.BVW7W7Ao.js";import{a as F}from"./team.BdQJIqcX.js";import"./jwt.CBjnGchD.js";import{M}from"./Modal.oLN6tDxH.js";import{A as q}from"./arrow-up-right.vFhbeTOi.js";import{C}from"./check.CKlj7MwC.js";import{c as O}from"./createLucideIcon.BiEhg7VK.js";import{P as z}from"./Pagination.CZuPcvIv.js";import"./toast.CxFvZIRu.js";import"./index.DgoachrA.js";import"./index.BRGkBvr2.js";import"./use-outside-click.DwmohMvh.js";import"./use-keydown.DHXzDwpw.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=O("ListTodo",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);function V(c){const{user:n,onTopicClick:T,teamId:u}=c,{activities:i}=n,h=L(F),[m,f]=x.useState(!1),o=s=>{const{resourceId:t,resourceTitle:r,resourceType:a,isCustomResource:p,resourceSlug:d}=s,A=a==="question"?`/questions/${t}`:a==="best-practice"?`/best-practices/${t}`:p&&a==="roadmap"?`/r/${d}`:`/${t}`;return e.jsx("a",{className:"font-medium underline transition-colors hover:cursor-pointer hover:text-black",target:"_blank",href:`${A}?t=${u}`,children:r})},l=s=>e.jsx("span",{className:"ml-1 text-xs text-gray-400",children:D(new Date(s).toISOString(),!0)}),v=n.avatar?`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_AVATAR_BASE_URL}/${n.avatar}`:"/images/default-avatar.png",b=h?.personalProgressOnly&&h.role==="member"&&n.memberId!==h.memberId,g=e.jsxs("a",{href:`/team/member?t=${u}&m=${n?.memberId}`,className:P("inline-flex items-center gap-1.5 underline underline-offset-2 hover:underline",b?"pointer-events-none cursor-default no-underline":""),onClick:s=>{b&&s.preventDefault()},"aria-disabled":b,children:[e.jsx("img",{className:"inline-block h-5 w-5 rounded-full",src:v,alt:n.name}),e.jsx("span",{className:"font-medium",children:n?.name||"Unknown"})]});if(i.length===1){const s=i[0],{actionType:t,topicTitles:r}=s,a=r?.length||0;return e.jsxs("li",{className:"flex flex-wrap items-center gap-1 rounded-md border px-2 py-2.5 text-sm",children:[t==="in_progress"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1 flex w-full flex-wrap items-center",children:[g," started ",a," topic",a>1?"s":""," in ",o(s)," ",l(s.updatedAt)]}),e.jsx(w,{className:"pl-5",topicTitles:r||[]})]}),t==="done"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1 flex w-full flex-wrap items-center",children:[g," completed ",a," topic",a>1?"s":""," in ",o(s)," ",l(s.updatedAt)]}),e.jsx(w,{className:"pl-5",topicTitles:r||[]})]}),t==="answered"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1 flex w-full flex-wrap items-center",children:[g," answered ",a," question",a>1?"s":""," in ",o(s)," ",l(s.updatedAt)]}),e.jsx(w,{className:"pl-5",topicTitles:r||[]})]})]},n._id)}const y=new Set(i.map(s=>s.resourceId)).size,N=m?i.length:5;return e.jsxs("li",{className:"overflow-hidden rounded-md border",children:[e.jsxs("h3",{className:"flex flex-wrap items-center gap-1 bg-gray-100 px-2 py-2.5 text-sm",children:[g," has ",i.length," updates in ",y," resource(s)"]}),e.jsxs("div",{className:"py-3",children:[e.jsx("ul",{className:"ml-2 flex flex-col divide-y pr-2 sm:ml-[36px]",children:i.slice(0,N).map((s,t)=>{const{actionType:r,topicTitles:a}=s,p=a?.length||0;return e.jsxs("li",{className:P("text-sm text-gray-600",t===0?"pb-2.5":"py-2.5",t===i.length-1?"pb-0":""),children:[r==="in_progress"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1",children:["Started ",p," topic",p>1?"s":""," in ",o(s)," ",l(s.updatedAt)]}),e.jsx(w,{topicTitles:a||[]})]}),r==="done"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1",children:["Completed ",p," topic",p>1?"s":""," in ",o(s)," ",l(s.updatedAt)]}),e.jsx(w,{topicTitles:a||[]})]}),r==="answered"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1",children:["Answered ",p," question",p>1?"s":""," in ",o(s)," ",l(s.updatedAt)]}),e.jsx(w,{topicTitles:a||[]})]})]},s._id)})}),i.length>5&&e.jsx("button",{className:"ml-2 mt-3 flex items-center gap-2 rounded-md border border-gray-300 p-1 text-xs uppercase tracking-wide text-gray-600 transition-colors hover:border-black hover:bg-black hover:text-white sm:ml-[36px]",onClick:()=>f(!m),children:m?e.jsxs(e.Fragment,{children:[e.jsx(E,{size:14}),"Show less"]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{size:14}),"Show more"]})})]})]},n._id)}function W(c){const{activity:n,onClose:T}=c,{resourceId:u,resourceType:i,isCustomResource:h,topicTitles:m=[],actionType:f}=n;let o="";return i==="roadmap"?o=h?`/r/${u}`:`/${u}`:i==="best-practice"?o=`/best-practices/${u}`:o=`/questions/${u}`,e.jsx(M,{onClose:()=>{T()},children:e.jsxs("div",{className:"popup-body relative rounded-lg bg-white p-4 shadow",children:[e.jsxs("span",{className:"mb-2 flex items-center justify-between text-lg font-semibold capitalize",children:[e.jsx("span",{className:"flex items-center gap-2",children:f.replace("_"," ")}),e.jsxs("a",{href:o,target:"_blank",className:"flex items-center gap-1 rounded-md border border-transparent py-0.5 pl-2 pr-1 text-sm font-normal text-gray-400 transition-colors hover:border-black hover:bg-black hover:text-white",children:["Visit Page"," ",e.jsx(q,{size:16,strokeWidth:2,className:"relative top-px"})]})]}),e.jsx("ul",{className:"flex max-h-[50vh] flex-col gap-1 overflow-y-auto max-md:max-h-full",children:m.map(l=>{const v=f==="done"?C:f==="in_progress"?U:C;return e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(v,{strokeWidth:3,className:"relative top-[4px] text-green-500",size:16}),l]},l)})})]})})}function H(c){return e.jsx("div",{className:"rounded-md",children:e.jsxs("div",{className:"flex flex-col items-center p-7 text-center sm:p-14",children:[e.jsx(B,{className:"mb-4 h-[60px] w-[60px] opacity-10 sm:h-[60px] sm:w-[60px]"}),e.jsx("h2",{className:"text-lg font-semibold sm:text-lg",children:"No Activity"}),e.jsx("p",{className:"my-1 max-w-[400px] text-balance text-sm text-gray-500 sm:my-2 sm:text-base",children:"Team activity will appear here once members start tracking their progress."})]})})}function he(){const{t:c}=_(),n=I(),[T,u]=x.useState(!0),[i,h]=x.useState(null),[m,f]=x.useState({data:{users:[],activities:[]},totalCount:0,totalPages:0,currPage:1,perPage:21}),[o,l]=x.useState(1),v=async(t=1)=>{const{response:r,error:a}=await $(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-get-team-activity/${c}`,{currPage:t});if(a||!r){n.error(a?.message||"Failed to get team activity");return}f(r),l(r.currPage)};x.useEffect(()=>{c&&v().then(()=>{S.set(""),u(!1)})},[c]);const{users:b,activities:g}=m?.data,y=x.useMemo(()=>g?.filter(t=>t.activity.length>0&&t.activity.some(r=>(r?.topicTitles?.length||0)>0)),[g]),N=x.useMemo(()=>new Set(y?.map(t=>new Date(t.createdAt).setHours(0,0,0,0)).sort((t,r)=>new Date(r).getTime()-new Date(t).getTime())),[y]),s=x.useMemo(()=>{const t=[];for(const r of N){const a=y.filter(d=>new Date(d.createdAt).setHours(0,0,0,0)===r),p=b.map(d=>{const A=a.filter(j=>j.userId===d._id).flatMap(j=>j.activity).filter(j=>(j?.topicTitles?.length||0)>0).sort((j,k)=>new Date(k.updatedAt).getTime()-new Date(j.updatedAt).getTime());return{...d,activities:A}}).filter(d=>d.activities.length>0).sort((d,A)=>new Date(A.activities[0].updatedAt).getTime()-new Date(d.activities[0].updatedAt).getTime());t.push(...p)}return t},[b,g]);if(!c){window.location.href="/";return}return T?null:e.jsxs(e.Fragment,{children:[i&&e.jsx(W,{activity:i,onClose:()=>h(null)}),s.length>0?e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"mb-4 flex w-full items-center justify-between text-xs uppercase text-gray-400",children:"Team Activity"}),e.jsx("ul",{className:"mb-4 mt-2 flex flex-col gap-3",children:s.map((t,r)=>e.jsx(V,{user:t,teamId:c,onTopicClick:h},`${t._id}-${r}`))}),e.jsx(z,{currPage:o,totalPages:m.totalPages,totalCount:m.totalCount,perPage:m.perPage,onPageChange:t=>{l(t),S.set("Loading..."),v(t).finally(()=>{S.set("")})}})]}):e.jsx(H,{teamId:c})]})}export{he as TeamActivityPage};
