import{j as e}from"./jsx-runtime.CAnB4H9Z.js";import{r as l}from"./index.qVDZzPEr.js";import{G as U,a as N}from"./GoogleIcon.CpoJrDvC.js";import{s as R}from"./jwt.CBjnGchD.js";import{b as I,h as _}from"./http.DleWH6fe.js";import{S as L}from"./Spinner.xsriOokz.js";const E="githubRedirectAt",P="githubLastPage";function T(m){const{isDisabled:g,setIsDisabled:t}=m,[a,n]=l.useState(!1),[u,c]=l.useState("");l.useEffect(()=>{const o=new URLSearchParams(window.location.search),i=o.get("code"),d=o.get("state"),p=o.get("provider");!i||!d||p!=="github"||(n(!0),t?.(!0),I(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-github-callback${window.location.search}`).then(({response:r,error:w})=>{if(!r?.token){const b=w?.message||"Something went wrong.";c(b),n(!1),t?.(!1);return}let s="/";const S=localStorage.getItem(E),h=localStorage.getItem(P);if(S&&h){const b=parseInt(S,10);Date.now()-b<30*1e3&&(s=h)}const x=localStorage.getItem("authRedirect");x&&(localStorage.removeItem("authRedirect"),s=x),localStorage.removeItem(E),localStorage.removeItem(P),R(r.token),window.location.href=s}).catch(r=>{c("Something went wrong. Please try again later."),n(!1),t?.(!1)}))},[]);const f=async()=>{n(!0),t?.(!0);const{response:o,error:i}=await I(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-github-login`);if(i||!o?.loginUrl){c(i?.message||"Something went wrong. Please try again later."),n(!1),t?.(!1);return}if(!["/login","/signup"].includes(window.location.pathname)){const d=["/respond-invite","/befriend","/r","/ai"].includes(window.location.pathname)?window.location.pathname+window.location.search:window.location.pathname;localStorage.setItem(E,Date.now().toString()),localStorage.setItem(P,d)}window.location.href=o.loginUrl};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:a||g,onClick:f,children:[a?e.jsx(L,{className:"h-[18px] w-[18px]",isDualRing:!1}):e.jsx(U,{className:"h-[18px] w-[18px]"}),"Continue with GitHub"]}),u&&e.jsx("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:u})]})}const y="googleRedirectAt",j="googleLastPage";function C(m){const{isDisabled:g,setIsDisabled:t}=m,[a,n]=l.useState(!1),[u,c]=l.useState("");l.useEffect(()=>{const o=new URLSearchParams(window.location.search),i=o.get("code"),d=o.get("state"),p=o.get("provider");!i||!d||p!=="google"||(n(!0),t?.(!0),I(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-google-callback${window.location.search}`).then(({response:r,error:w})=>{if(!r?.token){c(w?.message||"Something went wrong."),n(!1),t?.(!1);return}let s="/";const S=localStorage.getItem(y),h=localStorage.getItem(j);if(S&&h){const b=parseInt(S,10);Date.now()-b<30*1e3&&(s=h)}const x=localStorage.getItem("authRedirect");x&&(localStorage.removeItem("authRedirect"),s=x),localStorage.removeItem(y),localStorage.removeItem(j),R(r.token),window.location.href=s}).catch(r=>{c("Something went wrong. Please try again later."),n(!1),t?.(!1)}))},[]);const f=()=>{n(!0),t?.(!0),I(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-google-login`).then(({response:o,error:i})=>{if(!o?.loginUrl){c(i?.message||"Something went wrong."),n(!1),t?.(!1);return}if(!["/login","/signup"].includes(window.location.pathname)){const d=["/respond-invite","/befriend","/r","/ai"].includes(window.location.pathname)?window.location.pathname+window.location.search:window.location.pathname;localStorage.setItem(y,Date.now().toString()),localStorage.setItem(j,d)}window.location.href=o.loginUrl}).catch(o=>{c("Something went wrong. Please try again later."),n(!1),t?.(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:a||g,onClick:f,children:[a?e.jsx(L,{className:"h-[18px] w-[18px]",isDualRing:!1}):e.jsx(N,{className:"h-[18px] w-[18px]"}),"Continue with Google"]}),u&&e.jsx("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:u})]})}function B(m){const{className:g}=m;return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:g,x:"0px",y:"0px",width:"100",height:"100",viewBox:"0,0,256,256",children:e.jsx("g",{transform:"translate(-26.66667,-26.66667) scale(1.20833,1.20833)",children:e.jsx("g",{fill:"none",fillRule:"nonzero",stroke:"none",strokeWidth:"1",strokeLinecap:"butt",strokeLinejoin:"miter",strokeMiterlimit:"10",strokeDasharray:"",strokeDashoffset:"0",fontFamily:"none",fontWeight:"none",fontSize:"none",textAnchor:"none",style:{mixBlendMode:"normal"},children:e.jsxs("g",{transform:"scale(5.33333,5.33333)",children:[e.jsx("path",{d:"M42,37c0,2.762 -2.238,5 -5,5h-26c-2.761,0 -5,-2.238 -5,-5v-26c0,-2.762 2.239,-5 5,-5h26c2.762,0 5,2.238 5,5z",fill:"#0288d1"}),e.jsx("path",{d:"M12,19h5v17h-5zM14.485,17h-0.028c-1.492,0 -2.457,-1.112 -2.457,-2.501c0,-1.419 0.995,-2.499 2.514,-2.499c1.521,0 2.458,1.08 2.486,2.499c0,1.388 -0.965,2.501 -2.515,2.501zM36,36h-5v-9.099c0,-2.198 -1.225,-3.698 -3.192,-3.698c-1.501,0 -2.313,1.012 -2.707,1.99c-0.144,0.35 -0.101,1.318 -0.101,1.807v9h-5v-17h5v2.616c0.721,-1.116 1.85,-2.616 4.738,-2.616c3.578,0 6.261,2.25 6.261,7.274l0.001,9.726z",fill:"#ffffff"})]})})})})}const v="linkedInRedirectAt",D="linkedInLastPage";function F(m){const{isDisabled:g,setIsDisabled:t}=m,[a,n]=l.useState(!1),[u,c]=l.useState("");l.useEffect(()=>{const o=new URLSearchParams(window.location.search),i=o.get("code"),d=o.get("state"),p=o.get("provider");!i||!d||p!=="linkedin"||(n(!0),t?.(!0),I(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-linkedin-callback${window.location.search}`).then(({response:r,error:w})=>{if(!r?.token){c(w?.message||"Something went wrong."),n(!1),t?.(!1);return}let s="/";const S=localStorage.getItem(v),h=localStorage.getItem(D);if(S&&h){const b=parseInt(S,10);Date.now()-b<30*1e3&&(s=h)}const x=localStorage.getItem("authRedirect");x&&(localStorage.removeItem("authRedirect"),s=x),localStorage.removeItem(v),localStorage.removeItem(D),R(r.token),window.location.href=s}).catch(r=>{c("Something went wrong. Please try again later."),n(!1),t?.(!1)}))},[]);const f=()=>{n(!0),t?.(!0),I(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-linkedin-login`).then(({response:o,error:i})=>{if(!o?.loginUrl){c(i?.message||"Something went wrong."),n(!1),t?.(!1);return}if(!["/login","/signup"].includes(window.location.pathname)){const d=["/respond-invite","/befriend","/r","/ai"].includes(window.location.pathname)?window.location.pathname+window.location.search:window.location.pathname;localStorage.setItem(v,Date.now().toString()),localStorage.setItem(D,d)}window.location.href=o.loginUrl}).catch(o=>{c("Something went wrong. Please try again later."),n(!1),t?.(!1)})};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"inline-flex h-10 w-full items-center justify-center gap-2 rounded border border-slate-300 bg-white p-2 text-sm font-medium text-black outline-none focus:ring-2 focus:ring-[#333] focus:ring-offset-1 disabled:cursor-not-allowed disabled:opacity-60",disabled:a||g,onClick:f,children:[a?e.jsx(L,{className:"h-[18px] w-[18px]",isDualRing:!1}):e.jsx(B,{className:"h-[18px] w-[18px]"}),"Continue with LinkedIn"]}),u&&e.jsx("p",{className:"mb-2 mt-1 text-sm font-medium text-red-600",children:u})]})}function O(m){const{isDisabled:g,setIsDisabled:t}=m,[a,n]=l.useState(""),[u,c]=l.useState(""),[f,o]=l.useState(""),[i,d]=l.useState(!1),p=async r=>{r.preventDefault(),d(!0),t?.(!0),o("");const{response:w,error:s}=await _(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-login`,{email:a,password:u});if(w?.token){R(w.token),window.location.reload();return}if(s.type==="user_not_verified"){window.location.href=`/verification-pending?email=${encodeURIComponent(a)}`;return}d(!1),t?.(!1),o(s?.message||"Something went wrong. Please try again later.")};return e.jsxs("form",{className:"w-full",onSubmit:p,children:[e.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email address"}),e.jsx("input",{name:"email",type:"email",autoComplete:"email",required:!0,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",placeholder:"Email Address",value:a,onInput:r=>n(String(r.target.value))}),e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),e.jsx("input",{name:"password",type:"password",autoComplete:"current-password",required:!0,className:"mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",placeholder:"Password",value:u,onInput:r=>c(String(r.target.value))}),e.jsx("p",{className:"mb-3 mt-2 text-sm text-gray-500",children:e.jsx("a",{href:"/forgot-password",className:"text-blue-800 hover:text-blue-600",children:"Reset your password?"})}),f&&e.jsx("p",{className:"mb-2 rounded-md bg-red-100 p-2 text-red-800",children:f}),e.jsx("button",{type:"submit",disabled:i||g,className:"inline-flex w-full items-center justify-center rounded-lg bg-black p-2 py-3 text-sm font-medium text-white outline-none focus:ring-2 focus:ring-black focus:ring-offset-1 disabled:bg-gray-400",children:i?"Please wait...":"Continue"})]})}function G(m){const{isDisabled:g,setIsDisabled:t}=m,[a,n]=l.useState(""),[u,c]=l.useState(""),[f,o]=l.useState(""),[i,d]=l.useState(""),[p,r]=l.useState(!1),w=async s=>{s.preventDefault(),r(!0),t?.(!0),d("");const{response:S,error:h}=await _(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-register`,{email:a,password:u,name:f});if(h||S?.status!=="ok"){r(!1),t?.(!1),d(h?.message||"Something went wrong. Please try again later.");return}window.location.href=`/verification-pending?email=${encodeURIComponent(a)}`};return e.jsxs("form",{className:"flex w-full flex-col gap-2",onSubmit:w,children:[e.jsx("label",{htmlFor:"name",className:"sr-only",children:"Name"}),e.jsx("input",{name:"name",type:"text",autoComplete:"name",min:3,max:50,required:!0,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",placeholder:"Full Name",value:f,onInput:s=>o(String(s.target.value))}),e.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email address"}),e.jsx("input",{name:"email",type:"email",autoComplete:"email",required:!0,className:"block w-full rounded-lg border border-gray-300 px-3 py-2  outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",placeholder:"Email Address",value:a,onInput:s=>n(String(s.target.value))}),e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),e.jsx("input",{name:"password",type:"password",autoComplete:"current-password",min:6,max:50,required:!0,className:"block w-full rounded-lg border border-gray-300 px-3 py-2 outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",placeholder:"Password",value:u,onInput:s=>c(String(s.target.value))}),i&&e.jsxs("p",{className:"rounded-lg bg-red-100 p-2 text-red-700",children:[i,"."]}),e.jsx("button",{type:"submit",disabled:p||g,className:"inline-flex w-full items-center justify-center rounded-lg bg-black p-2 py-3 text-sm font-medium text-white outline-none focus:ring-2 focus:ring-black focus:ring-offset-1 disabled:bg-gray-400",children:p?"Please wait...":"Continue to Verify Email"})]})}function q(m){const{type:g="login"}=m,[t,a]=l.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex w-full flex-col gap-2",children:[e.jsx(T,{isDisabled:t,setIsDisabled:a}),e.jsx(C,{isDisabled:t,setIsDisabled:a}),e.jsx(F,{isDisabled:t,setIsDisabled:a})]}),e.jsxs("div",{className:"flex w-full items-center gap-2 py-6 text-sm text-slate-600",children:[e.jsx("div",{className:"h-px w-full bg-slate-200"}),"OR",e.jsx("div",{className:"h-px w-full bg-slate-200"})]}),g==="login"?e.jsx(O,{isDisabled:t,setIsDisabled:a}):e.jsx(G,{isDisabled:t,setIsDisabled:a})]})}export{q as AuthenticationForm};
