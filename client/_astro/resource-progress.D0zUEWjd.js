import{g as f,a as A,T as P}from"./jwt.CBjnGchD.js";import{h as _,b}from"./http.DleWH6fe.js";import{r as q,t as C}from"./roadmap.BEsVk7__.js";async function B(e){const{topicId:t,resourceType:o,resourceId:n}=e,{done:s=[]}=await h(o,n)||{};return s?.includes(t)}async function F(e){const{topicId:t,resourceType:o,resourceId:n}=e,s=await h(o,n);return s?.done?.includes(t)?"done":s?.learning?.includes(t)?"learning":s?.skipped?.includes(t)?"skipped":"pending"}async function N(e,t){const{topicId:o,resourceType:n,resourceId:s}=e,{response:r,error:i}=await _(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-update-resource-progress`,{topicId:o,resourceType:n,resourceId:s,progress:t});if(i||!r?.done||!r?.learning)throw new Error(i?.message||"Something went wrong");return k(n,s,r.done,r.learning,r.skipped),r}function U(e,t){if(!["frontend","backend"].includes(t))return;const n=f()?.id;if(!n)return;const s=`${e}-${t}-${n}-progress`,r=`${e}-${t}-${n}-cleared`,i=parseInt(localStorage.getItem(r)||"0",10);i>=10||(localStorage.removeItem(s),localStorage.setItem(r,`${i+1}`))}async function h(e,t){if(!A.get(P))return{done:[],learning:[],skipped:[]};const o=f()?.id,n=`${e}-${t}-${o}-progress`,s=`${e}-${t}-favorite`,r=localStorage.getItem(s),i=JSON.parse(r||"0")===1,a=localStorage.getItem(n),d=JSON.parse(a||"null"),u=d?.timestamp,g=new Date().getTime()-parseInt(u||"0",10)>15*60*1e3;return!d||g?I(e,t):(k(e,t,d?.done||[],d?.learning||[],d?.skipped||[]),window.dispatchEvent(new CustomEvent("mark-favorite",{detail:{resourceType:e,resourceId:t,isFavorite:i}})),d)}async function I(e,t){const{response:o,error:n}=await b(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-get-user-resource-progress`,{resourceType:e,resourceId:t});return n||!o?(console.error(n),{done:[],learning:[],skipped:[]}):(k(e,t,o?.done||[],o?.learning||[],o?.skipped||[]),window.dispatchEvent(new CustomEvent("mark-favorite",{detail:{resourceType:e,resourceId:t,isFavorite:o.isFavorite}})),o)}function k(e,t,o,n,s){q.set({done:o,learning:n,skipped:s});const r=f()?.id;localStorage.setItem(`${e}-${t}-${r}-progress`,JSON.stringify({done:o,learning:n,skipped:s,timestamp:new Date().getTime()}))}function x(e,t=document){const o=[];return t.querySelectorAll(`[data-group-id$="-${e}"]`).forEach(n=>{const s=n?.dataset?.groupId||"";new RegExp(`^\\d+-${e}$`).test(s)&&o.push(n)}),l([`[data-group-id="${e}"]`,`[data-group-id="check:${e}"]`,`[data-node-id="${e}"]`,`[data-id="${e}"]`,`[data-checklist-checkbox][data-checklist-id="${e}"]`,`[data-checklist-label][data-checklist-id="${e}"]`],t).forEach(n=>{o.push(n)}),o}function m(e,t){const o=t==="learning",n=t==="skipped",s=t==="done",r=t==="removed";x(e).forEach(a=>{s?(a.classList.add("done"),a.classList.remove("learning","skipped")):o?(a.classList.add("learning"),a.classList.remove("done","skipped")):n?(a.classList.add("skipped"),a.classList.remove("done","learning")):r?(a.classList.add("removed"),a.classList.remove("done","learning","skipped")):a.classList.remove("done","skipped","learning","removed")})}function K(){const e=l([".clickable-group",'[data-type="topic"]','[data-type="subtopic"]',".react-flow__node-topic",".react-flow__node-subtopic"]);for(const t of e)t.classList.remove("done","skipped","learning","removed")}async function H(e,t){const{done:o=[],learning:n=[],skipped:s=[]}=await h(e,t)||{};o.forEach(r=>{m(r,"done")}),n.forEach(r=>{m(r,"learning")}),s.forEach(r=>{m(r,"skipped")}),T()}function l(e,t=document){const o=[];return e.forEach(n=>{t.querySelectorAll(n).forEach(s=>{o.push(s)})}),o}function T(){const e=document.querySelectorAll("[data-progress-nums-container]"),t=document.querySelectorAll("[data-progress-nums]");if(e.length===0||t.length===0)return;const o=l([".clickable-group",'[data-type="topic"]','[data-type="subtopic"]',".react-flow__node-topic",".react-flow__node-subtopic"]).length,n=document.querySelectorAll('[data-group-id^="ext_link:"]').length,s=document.querySelectorAll('[data-group-id^="json:"]').length,r=document.querySelectorAll('[data-group-id^="check:"]').length,i=document.querySelectorAll('[data-group-id^="check:"].done').length,a=document.querySelectorAll('[data-group-id^="check:"].learning').length,d=document.querySelectorAll('[data-group-id^="check:"].skipped').length,u=document.querySelectorAll(".clickable-group.removed").length,p=o-n-s-r-u;C.set(p);const g=l(['.clickable-group.done:not([data-group-id^="ext_link:"])',"[data-node-id].done","[data-id].done"]).length-i,w=l([".clickable-group.learning","[data-node-id].learning","[data-id].learning"]).length-a,E=l([".clickable-group.skipped","[data-node-id].skipped","[data-id].skipped"]).length-d,S=document.querySelectorAll("[data-progress-done]");S.length>0&&S.forEach(c=>c.innerHTML=`${g}`);const v=document.querySelectorAll("[data-progress-learning]");v.length>0&&v.forEach(c=>c.innerHTML=`${w}`);const $=document.querySelectorAll("[data-progress-skipped]");$.length>0&&$.forEach(c=>c.innerHTML=`${E}`);const y=document.querySelectorAll("[data-progress-total]");y.length>0&&y.forEach(c=>c.innerHTML=`${p}`);const R=Math.round((g+E)/p*100)||0,L=document.querySelectorAll("[data-progress-percentage]");L.length>0&&L.forEach(c=>c.innerHTML=`${R}`),e.forEach(c=>c.classList.remove("striped-loader")),t.forEach(c=>{c.classList.remove("opacity-0")})}export{m as a,T as b,K as c,U as d,F as g,B as i,H as r,x as t,N as u};
