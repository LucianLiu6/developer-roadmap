import{j as e}from"./jsx-runtime.CAnB4H9Z.js";import{r as a}from"./index.qVDZzPEr.js";import{c as D,h as B,d as O,b as L,a as T}from"./http.DleWH6fe.js";import{u as V}from"./use-auth.BGqQ_BxX.js";import{p as h}from"./page.BgB1PChG.js";import{u as _}from"./use-team-id.C2iCuhZl.js";import{u as I}from"./use-outside-click.DwmohMvh.js";import{R as A}from"./RoleDropdown.Dh2ybo52.js";import{g as F}from"./browser.t5_cZ6DD.js";import{u as P}from"./index.BVW7W7Ao.js";import{a as X,b as k}from"./team.BdQJIqcX.js";import{u as z}from"./use-toast.CP_0jytG.js";import{M as Y}from"./MoreVerticalIcon.CZUHT-Xy.js";import{c as $}from"./classname.BR_JCrAi.js";import"./jwt.CBjnGchD.js";import"./index.DgoachrA.js";import"./ChevronDownIcon.kwzq5ePN.js";import"./index.BRGkBvr2.js";import"./toast.CxFvZIRu.js";function U(r){const{role:s,className:l}=r;return e.jsx("span",{className:$(`items-center rounded-full px-2 py-0.5 text-xs capitalize sm:flex ${["admin"].includes(s)?"bg-blue-100 text-blue-700 ":"bg-gray-100 text-gray-700 "} ${["manager"].includes(s)?"bg-green-100 text-green-700":""}`,l),children:s})}function q(r){const{onClose:s}=r,l=a.useRef(null),p=a.useRef(null),[c,f]=a.useState(""),[u,n]=a.useState(!1),[x,o]=a.useState(""),{teamId:d}=_();a.useEffect(()=>{o(""),f(""),p?.current?.focus()},[]);const b=async m=>{if(m.preventDefault(),n(!0),o(""),c.toUpperCase()!=="LEAVE"){o("Verification text does not match"),n(!1);return}const{response:g,error:v}=await D(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-leave-team/${d}`,{});if(v||!g){n(!1),o(v?.message||"Something went wrong");return}window.location.href="/account?c=tl"},j=()=>{n(!1),o(""),f(""),s()};return I(l,j),e.jsx("div",{className:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e.jsx("div",{className:"relative h-full w-full max-w-md p-4 md:h-auto",children:e.jsxs("div",{ref:l,className:"popup-body relative rounded-lg bg-white p-4 shadow",children:[e.jsx("h2",{className:"text-2xl font-semibold text-black",children:"Leave Team"}),e.jsx("p",{className:"text-gray-500",children:"You will lose access to the team, the roadmaps and progress of other team members."}),e.jsx("p",{className:"-mb-2 mt-3 text-base font-medium text-black",children:'Please type "leave" to confirm.'}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"my-4",children:[e.jsx("input",{ref:p,type:"text",name:"leave-team",id:"leave-team",className:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 outline-none placeholder:text-gray-400 focus:border-gray-400",placeholder:'Type "leave" to confirm',required:!0,autoFocus:!0,value:c,onInput:m=>f(m.target.value)}),x&&e.jsx("p",{className:"mt-2 rounded-lg bg-red-100 p-2 text-red-700",children:x})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",disabled:u,onClick:j,className:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u||c.toUpperCase()!=="LEAVE",className:"flex-grow cursor-pointer rounded-lg bg-red-500 py-2 text-white disabled:opacity-40",children:u?"Please wait ..":"Leave Team"})]})]})]})})})}function G(r){const[s,l]=a.useState(!1);return e.jsxs(e.Fragment,{children:[s&&e.jsx(q,{onClose:()=>{l(!1)}}),e.jsx("button",{onClick:()=>{l(!0)},className:"flex h-7 min-w-[95px] items-center justify-center rounded-md border border-gray-200 bg-gray-50 px-2 py-1.5 text-sm font-medium leading-none text-red-600",children:"Leave team"})]})}function H(r){const{onClose:s,onInvited:l}=r,p=a.useRef(null),c=a.useRef(null),[f,u]=a.useState("member"),[n,x]=a.useState(""),[o,d]=a.useState(!1),[b,j]=a.useState(""),{teamId:m}=_();a.useEffect(()=>{c?.current?.focus()},[]);const g=async S=>{S.preventDefault(),d(!0),j("");const{response:N,error:R}=await B(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-invite-member/${m}`,{email:n,role:f});if(R||!N){d(!1),j(R?.message||"Something went wrong");return}d(!1),v(),l()},v=()=>{d(!1),j(""),s()};return I(p,v),e.jsx("div",{className:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e.jsx("div",{className:"relative h-full w-full max-w-md p-4 md:h-auto",children:e.jsxs("div",{ref:p,className:"popup-body relative rounded-lg bg-white p-4 shadow",children:[e.jsx("h3",{className:"mb-1.5 text-xl font-medium sm:text-2xl",children:"Invite Member"}),e.jsx("p",{className:"mb-3 hidden text-sm leading-none text-gray-400 sm:block",children:"Enter the email and role below to invite a member."}),e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{className:"my-4 mt-0 flex flex-col gap-2 sm:mt-4",children:[e.jsx("input",{ref:c,type:"email",name:"invite-member",id:"invite-member",className:"mt-2 block w-full rounded-md border border-gray-300 px-3 py-2 outline-none placeholder:text-gray-400 focus:border-gray-400",placeholder:"Enter email address",required:!0,autoFocus:!0,value:n,onInput:S=>x(S.target.value)}),e.jsx("div",{className:"flex h-[42px] w-full flex-col",children:e.jsx(A,{className:"h-full w-full",selectedRole:f,setSelectedRole:u})}),b&&e.jsx("p",{className:" rounded-md border border-red-300 bg-red-50 p-2 text-sm text-red-700",children:b})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",disabled:o,onClick:v,className:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:o||!n,className:"flex-grow cursor-pointer rounded-lg bg-black py-2 text-center text-white disabled:opacity-40",children:o?"Please wait ..":"Invite"})]})]})]})})})}function J(r){const{onClose:s,onUpdated:l,member:p}=r,c=a.useRef(null),[f,u]=a.useState(p.role),[n,x]=a.useState(!1),[o,d]=a.useState(""),{teamId:b}=_(),j=async g=>{g.preventDefault(),x(!0),d("");const{response:v,error:S}=await O(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-update-member-role/${b}/${p._id}`,{role:f});if(S||!v){x(!1),d(S?.message||"Something went wrong");return}x(!1),l()},m=()=>{x(!1),d(""),s()};return I(c,m),e.jsx("div",{className:"popup fixed left-0 right-0 top-0 z-50 flex h-full items-center justify-center overflow-y-auto overflow-x-hidden bg-black/50",children:e.jsx("div",{className:"relative h-full w-full max-w-md p-4 md:h-auto",children:e.jsxs("div",{ref:c,className:"popup-body relative rounded-lg bg-white p-4 shadow",children:[e.jsx("h3",{className:"mb-1.5 text-xl font-medium sm:text-2xl",children:"Update Role"}),e.jsx("p",{className:"mb-3 hidden text-sm leading-none text-gray-400 sm:block",children:"Select the role to update for this member"}),e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{className:"my-4 mt-0 flex flex-col gap-2 sm:mt-4",children:[e.jsx("span",{className:"mt-2 block w-full rounded-md bg-gray-100 p-2",children:p.invitedEmail}),e.jsx("div",{className:"flex h-[42px] w-full flex-col",children:e.jsx(A,{className:"h-full w-full",selectedRole:f,setSelectedRole:u})}),o&&e.jsx("p",{className:" rounded-md border border-red-300 bg-red-50 p-2 text-sm text-red-700",children:o})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",disabled:n,onClick:m,className:"flex-grow cursor-pointer rounded-lg bg-gray-200 py-2 text-center",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:n||!f,className:"flex-grow cursor-pointer rounded-lg bg-black py-2 text-center text-white disabled:opacity-40",children:n?"Please wait ..":"Update Role"})]})]})]})})})}function K({member:r,onUpdateMember:s,onDeleteMember:l,onResendInvite:p,isDisabled:c=!1,onSendProgressReminder:f,allowProgressReminder:u=!1,allowUpdateRole:n=!0}){const x=a.useRef(null),[o,d]=a.useState(!1),[b,j]=a.useState(!1);I(x,()=>{d(!1)});const m=[...n?[{name:"Update Role",handleClick:()=>{s(),d(!1)}}]:[],...u?[{name:"Send Progress Reminder",handleClick:()=>{f(),d(!1)}}]:[],...["invited"].includes(r.status)?[{name:"Resend Invite",handleClick:()=>{p(),d(!1)}}]:[],{name:"Delete",handleClick:()=>{l(),d(!1)}}];return e.jsxs("div",{className:"relative",children:[e.jsx("button",{disabled:c,onClick:()=>d(!o),className:"ml-2 flex items-center opacity-60 transition-opacity hover:opacity-100 disabled:cursor-not-allowed disabled:opacity-30",children:e.jsx(Y,{className:"h-4 w-4"})}),o&&e.jsx("div",{ref:x,className:"align-right absolute right-0 top-full z-50 mt-1 w-[200px] rounded-md bg-slate-800 px-2 py-2 text-white shadow-md",children:e.jsx("ul",{children:m.map((g,v)=>e.jsx("li",{children:e.jsx("button",{onClick:g.handleClick,disabled:b,className:"flex w-full cursor-pointer items-center rounded p-2 text-sm font-medium text-slate-100 hover:bg-slate-700",children:g.name})},v))})})]})}function E(r){const{member:s,index:l,onResendInvite:p,onUpdateMember:c,canManageCurrentTeam:f,userId:u,onDeleteMember:n,onSendProgressReminder:x}=r,o=P(X),d=P(k),b=!s.hasProgress&&s.status==="joined",j=d&&!s.hasProgress&&s.status==="joined"&&s.userId!==u,m=o?.personalProgressOnly&&o.role==="member"&&String(s._id)!==o.memberId;return e.jsxs("div",{className:`flex items-center justify-between gap-2 p-3 ${l===0?"":"border-t"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.avatar?`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_AVATAR_BASE_URL}/${s.avatar}`:"/images/default-avatar.png",alt:s.name||"",className:"hidden h-10 w-10 rounded-full sm:block"}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-1 flex items-center gap-2 sm:hidden",children:e.jsx(U,{role:s.role})}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("h3",{className:"inline-grid grid-cols-[auto_auto_auto] items-center font-medium",children:[e.jsx("a",{href:`/team/member?t=${s.teamId}&m=${s._id}`,className:$("truncate",m?"pointer-events-none cursor-default no-underline":""),onClick:g=>{m&&g.preventDefault()},"aria-disabled":m,children:s.name}),b&&e.jsx("span",{className:"ml-2 rounded-full bg-red-400 px-2 py-0.5 text-xs font-normal text-white",children:"No Progress"}),s.userId===u&&e.jsx("span",{className:"ml-2 hidden text-xs font-normal text-blue-500 sm:inline",children:"You"})]}),e.jsxs("div",{className:"ml-2 flex items-center gap-0.5",children:[s.status==="invited"&&e.jsx("span",{className:"rounded-full bg-yellow-100 px-2 py-0.5 text-xs text-yellow-700",children:"Invited"}),s.status==="rejected"&&e.jsx("span",{className:"rounded-full bg-red-100 px-2 py-0.5 text-xs text-red-700",children:"Rejected"})]})]}),e.jsx("p",{className:"truncate text-sm text-gray-500",children:s.invitedEmail})]})]}),e.jsxs("div",{className:"flex shrink-0 items-center text-sm",children:[e.jsx("span",{className:"hidden sm:block",children:e.jsx(U,{role:s.role})}),f&&e.jsx(K,{allowUpdateRole:s.status!=="rejected",allowProgressReminder:j,onResendInvite:p,onSendProgressReminder:x,onDeleteMember:n,isDisabled:s.userId===u,onUpdateMember:c,member:s})]})]})}const C=100;function he(){const{t:r}=F(),s=z(),l=P(k),[p,c]=a.useState(),[f,u]=a.useState(!1),[n,x]=a.useState([]),[o,d]=a.useState(),b=V();async function j(){const{response:t,error:i}=await L(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-get-team/${r}`);if(i||!t){s.error(i?.message||"Something went wrong");return}t&&d(t)}async function m(){const{response:t,error:i}=await L(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-get-team-member-list/${r}`);if(i||!t){s.error(i?.message||"Failed to load team member list");return}x(t)}a.useEffect(()=>{r&&Promise.all([j(),m()]).finally(()=>{h.set("")})},[r]);async function g(t,i){h.set("Deleting member");const{response:w,error:y}=await D(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-delete-member/${t}/${i}`,{});if(y||!w){s.error(y?.message||"Something went wrong");return}s.success("Member has been deleted"),await m()}async function v(t,i){h.set("Resending Invite");const{response:w,error:y}=await T(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-resend-invite/${t}/${i}`,{});if(y||!w){s.error(y?.message||"Something went wrong");return}s.success("Invite has been sent")}async function S(t,i){h.set("Sending Reminder");const{response:w,error:y}=await T(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-send-progress-reminder/${t}/${i}`,{});if(y||!w){s.error(y?.message||"Something went wrong");return}s.success("Reminder has been sent")}const N=n.filter(t=>t.status==="joined"),R=n.filter(t=>t.status==="invited"),M=n.filter(t=>t.status==="rejected");return e.jsxs("div",{children:[p&&e.jsx(J,{member:p,onUpdated:()=>{h.set("Refreshing members"),m().finally(()=>{h.set("")}),c(void 0),s.success("Member has been updated")},onClose:()=>{c(void 0)}}),f&&e.jsx(H,{onInvited:()=>{s.success("Invite sent"),m().then(()=>null),u(!1)},onClose:()=>{u(!1)}}),e.jsxs("div",{children:[e.jsxs("div",{className:"rounded-md border",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 border-b p-3",children:[e.jsxs("p",{className:"hidden text-sm sm:block",children:[n.length," people in the team."]}),e.jsxs("p",{className:"block text-sm sm:hidden",children:[n.length," members"]}),e.jsx(G,{teamId:o?._id})]}),N.map((t,i)=>e.jsx(E,{member:t,index:i,teamId:r,userId:b?.id,onResendInvite:()=>{v(r,t._id).finally(()=>{h.set("")})},canManageCurrentTeam:l,onDeleteMember:()=>{g(r,t._id).finally(()=>{h.set("")})},onUpdateMember:()=>{c(t)},onSendProgressReminder:()=>{S(r,t._id).finally(()=>{h.set("")})}},i))]}),R.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-xs uppercase text-gray-400",children:"Invited Members"}),e.jsx("div",{className:"mt-2 rounded-md border",children:R.map((t,i)=>e.jsx(E,{member:t,index:i,teamId:r,userId:b?.id,onResendInvite:()=>{v(r,t._id).finally(()=>{h.set("")})},canManageCurrentTeam:l,onDeleteMember:()=>{g(r,t._id).finally(()=>{h.set("")})},onUpdateMember:()=>{c(t)},onSendProgressReminder:()=>{S(r,t._id).finally(()=>{h.set("")})}},i))})]}),M.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-xs uppercase text-gray-400",children:"Rejected Invites"}),e.jsx("div",{className:"mt-2 rounded-b-sm rounded-t-md border",children:M.map((t,i)=>e.jsx(E,{member:t,index:i,teamId:r,userId:b?.id,onResendInvite:()=>{v(r,t._id).finally(()=>{h.set("")})},canManageCurrentTeam:l,onDeleteMember:()=>{g(r,t._id).finally(()=>{h.set("")})},onUpdateMember:()=>{c(t)},onSendProgressReminder:()=>{S(r,t._id).finally(()=>{h.set("")})}},i))})]})]}),l&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{disabled:n.length>=C,onClick:()=>u(!0),className:"block w-full rounded-md border border-dashed border-gray-300 py-2 text-sm transition-colors hover:border-gray-600 hover:bg-gray-50 focus:outline-0",children:"+ Invite Member"})}),n.length>=C&&l&&e.jsx("p",{className:"mt-2 rounded-lg bg-red-100 p-2 text-red-700",children:"You have reached the maximum number of members in a team. Please reach out to us if you need more."})]})}export{he as TeamMembersPage};
