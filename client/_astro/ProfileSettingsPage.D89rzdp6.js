import{j as e}from"./jsx-runtime.CAnB4H9Z.js";import{r as o}from"./index.qVDZzPEr.js";import{a as y,h as v,b as C}from"./http.DleWH6fe.js";import{p as c}from"./page.BgB1PChG.js";import{u as S}from"./use-toast.CP_0jytG.js";import{c as R}from"./classname.BR_JCrAi.js";import"./jwt.CBjnGchD.js";import"./index.DgoachrA.js";import"./toast.CxFvZIRu.js";function I(h){const{authProvider:i,currentEmail:m,newEmail:f="",onSendVerificationCode:g,onVerificationCancel:d}=h,l=S(),[t,s]=o.useState(!1),[r,u]=o.useState(f!==""),[a,n]=o.useState(f),[w,b]=o.useState(!1),j=async p=>{if(p.preventDefault(),!a||!a.includes("@")||r)return;s(!0),c.set("Sending verification code");const{response:x,error:P}=await y(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-update-user-email`,{email:a});if(P||!x){l.error(P?.message||"Something went wrong"),s(!1),c.set("");return}c.set(""),s(!1),u(!0),g?.(a)},E=async()=>{if(w){l.error("You have already resent the verification code");return}s(!0),c.set("Resending verification code");const{response:p,error:x}=await y(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-resend-email-verification-code`,{email:a});if(x||!p){l.error(x?.message||"Something went wrong"),s(!1),c.set("");return}l.success("Verification code has been resent"),c.set(""),b(!0),s(!1)},N=async()=>{s(!0),c.set("Cancelling email verification");const{response:p,error:x}=await y(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-cancel-email-verification`,{});if(x||!p){l.error(x?.message||"Something went wrong"),s(!1),c.set("");return}c.set(""),d?.(),u(!1),n(""),s(!1)};return i&&i!=="email"?e.jsxs("div",{className:"block",children:[e.jsx("h2",{className:"text-xl font-bold sm:text-2xl",children:"Update Email"}),e.jsxs("p",{className:"mt-2 text-gray-400",children:["You have used ",i," when signing up. Please set your password first."]}),e.jsxs("div",{className:"mt-4 flex w-full flex-col",children:[e.jsx("label",{htmlFor:"current-email",className:"text-sm leading-none text-slate-500",children:"Current Email"}),e.jsx("input",{type:"email",name:"current-email",id:"current-email",autoComplete:"current-email",className:"mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",required:!0,disabled:!0,value:m})]}),e.jsx("p",{className:"mt-3 rounded-lg border border-red-600 px-2 py-1 text-red-600",children:"Please set your password first to update your email."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8 block",children:[e.jsx("h2",{className:"text-xl font-bold sm:text-2xl",children:"Update Email"}),e.jsx("p",{className:"mt-2 text-gray-400",children:"Use the form below to update your email."})]}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("label",{htmlFor:"current-email",className:"text-sm leading-none text-slate-500",children:"Current Email"}),e.jsx("input",{type:"email",name:"current-email",id:"current-email",autoComplete:"current-email",className:"mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",required:!0,disabled:!0,value:m})]}),e.jsxs("div",{className:R("flex w-full flex-col",{"rounded-lg border border-green-500 p-3":r}),children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("label",{htmlFor:"new-email",className:"text-sm leading-none text-slate-500",children:"New Email"}),r&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{type:"button",onClick:E,disabled:t||w,className:"flex items-center gap-1 text-sm font-medium leading-none text-green-600 transition-colors hover:text-green-700",children:[e.jsx("span",{className:"hidden sm:block",children:"Resend Verification Link"}),e.jsx("span",{className:"sm:hidden",children:"Resend Code"})]})})]}),e.jsx("input",{type:"email",name:"new-email",id:"new-email",autoComplete:"new-email",className:"mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",required:!0,placeholder:"Enter new email",value:a,onChange:p=>n(p.target.value),disabled:r}),!r&&e.jsx("button",{type:"submit",disabled:t||!a||!a.includes("@")||r,className:"mt-3 inline-flex w-full items-center justify-center rounded-lg bg-black p-2 py-3 text-sm font-medium text-white outline-none focus:ring-2 focus:ring-black focus:ring-offset-1 disabled:bg-gray-400",children:t?"Please wait...":"Send Verification Link"}),r&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:N,disabled:t,className:"font-regular mt-4 w-full rounded-lg border border-red-600 py-2 text-sm text-red-600 outline-none transition-colors hover:bg-red-500 hover:text-white focus:ring-2 focus:ring-red-500 focus:ring-offset-1",children:"Cancel Update"}),e.jsx("div",{className:"mt-3 flex items-center gap-2 rounded-lg bg-green-100 p-4",children:e.jsxs("span",{className:"text-sm text-green-800",children:["A verification link has been sent to your"," ",e.jsx("span",{children:"new email address"}),". Please follow the instructions in email to verify and update your email."]})})]})]})]})]})}function k(h){const{authProvider:i}=h,m=S(),[f,g]=o.useState(""),[d,l]=o.useState(""),[t,s]=o.useState(""),[r,u]=o.useState(!1),a=async n=>{if(n.preventDefault(),u(!0),d!==t){m.error("Passwords do not match"),u(!1);return}const{response:w,error:b}=await v(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-update-password`,{oldPassword:i==="email"?f:"social-auth",password:d,confirmPassword:t});if(b||!w){m.error(b?.message||"Something went wrong"),u(!1);return}g(""),l(""),s(""),m.success("Password updated successfully"),u(!1),setTimeout(()=>{window.location.reload()},1e3)};return e.jsxs("form",{onSubmit:a,children:[e.jsxs("div",{className:"mb-8 hidden md:block",children:[e.jsx("h2",{className:"text-3xl font-bold sm:text-4xl",children:"Password"}),e.jsx("p",{className:"mt-2 text-gray-400",children:"Use the form below to update your password."})]}),e.jsxs("div",{className:"space-y-4",children:[i==="email"&&e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("label",{htmlFor:"current-password",className:"text-sm leading-none text-slate-500",children:"Current Password"}),e.jsx("input",{disabled:i!=="email",type:"password",name:"current-password",id:"current-password",autoComplete:"current-password",className:"mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1 disabled:bg-gray-100",required:!0,minLength:6,placeholder:"Current password",value:f,onInput:n=>g(n.target.value)})]}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("label",{htmlFor:"new-password",className:"text-sm leading-none text-slate-500",children:"New Password"}),e.jsx("input",{type:"password",name:"new-password",id:"new-password",autoComplete:"new-password",className:"mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",required:!0,minLength:6,placeholder:"New password",value:d,onInput:n=>l(n.target.value)})]}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsx("label",{htmlFor:"new-password-confirmation",className:"text-sm leading-none text-slate-500",children:"Confirm New Password"}),e.jsx("input",{type:"password",name:"new-password-confirmation",id:"new-password-confirmation",className:"mt-2 block w-full rounded-lg border border-gray-300 px-3 py-2 shadow-sm outline-none placeholder:text-gray-400 focus:ring-2 focus:ring-black focus:ring-offset-1",autoComplete:"new-password",required:!0,minLength:6,placeholder:"Confirm New Password",value:t,onInput:n=>s(n.target.value)})]}),e.jsx("button",{type:"submit",disabled:r||!d||d!==t,className:"inline-flex w-full items-center justify-center rounded-lg bg-black p-2 py-3 text-sm font-medium text-white outline-none focus:ring-2 focus:ring-black focus:ring-offset-1 disabled:bg-gray-400",children:r?"Please wait...":"Update Password"})]})]})}function O(){const h=S(),[i,m]=o.useState(""),[f,g]=o.useState(""),[d,l]=o.useState(""),t=async()=>{const{error:s,response:r}=await C(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-me`);if(s||!r){h.error(s?.message||"Something went wrong");return}const{authProvider:u,email:a,newEmail:n}=r;m(u),g(a),l(n||"")};return o.useEffect(()=>{t().finally(()=>{c.set("")})},[]),e.jsxs(e.Fragment,{children:[e.jsx(k,{authProvider:i}),e.jsx("hr",{className:"my-8"}),e.jsx(I,{authProvider:i,currentEmail:f,newEmail:d,onSendVerificationCode:s=>{l(s),t().finally(()=>{})},onVerificationCancel:()=>{t().finally(()=>{})}},d)]})}export{O as ProfileSettingsPage};
