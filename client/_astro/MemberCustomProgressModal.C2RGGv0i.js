import{j as e}from"./jsx-runtime.CAnB4H9Z.js";import{r as l}from"./index.qVDZzPEr.js";import{D as X}from"./index.es.B1RiJbf6.js";import{S as $}from"./Spinner.xsriOokz.js";/* empty css                       */import{u as U}from"./use-outside-click.DwmohMvh.js";import{u as A}from"./use-keydown.DHXzDwpw.js";import{b as _}from"./http.DleWH6fe.js";import{a as h,u as B}from"./resource-progress.D0zUEWjd.js";import{u as F}from"./use-toast.CP_0jytG.js";import{u as O}from"./use-auth.BGqQ_BxX.js";import{p as D}from"./page.BgB1PChG.js";import{r as q}from"./dom.DTPLKm7E.js";import{X as z}from"./x.BPEozwHq.js";import{R as G}from"./readonly-editor.DRQmhAvb.js";function V(N){const{progress:n,member:i,resourceId:d,isLoading:w,onShowMyProgress:g,isCurrentUser:f}=N,E=n?.removed||[],c=n?.done.filter(m=>!E.includes(m)).length||0,p=n?.learning.filter(m=>!E.includes(m)).length||0,x=n?.skipped.filter(m=>!E.includes(m)).length||0,b=i.progress.find(m=>m.resourceId===d)?.total||0,y=Math.round(c/b*100);return e.jsxs(e.Fragment,{children:[f&&e.jsxs("div",{className:"sticky top-1 z-50 mx-1 mb-0 mt-1 rounded-xl bg-gray-900 p-4 text-gray-300",children:[e.jsx("h2",{className:"mb-1.5 text-base",children:"Follow the Instructions below to update your progress"}),e.jsxs("ul",{className:"flex flex-col gap-1",children:[e.jsxs("li",{className:"leading-loose",children:[e.jsx("kbd",{className:"rounded-md bg-yellow-200 px-2 py-1.5 text-xs text-gray-900",children:"Right Mouse Click"})," ","on a topic to mark as"," ",e.jsx("span",{className:"font-medium text-white",children:"Done"}),"."]}),e.jsxs("li",{className:"leading-loose",children:[e.jsx("kbd",{className:"rounded-md bg-yellow-200 px-2 py-1.5 text-xs text-gray-900",children:"Shift"})," ","+"," ",e.jsx("kbd",{className:"rounded-md bg-yellow-200 px-2 py-1.5 text-xs text-gray-900",children:"Click"})," ","on a topic to mark as"," ",e.jsx("span",{className:"font-medium text-white",children:"In progress"}),"."]})]})]}),e.jsxs("div",{className:"p-4",children:[!f&&e.jsxs("div",{className:"mb-5 mt-0 text-left md:mt-4 md:text-center",children:[e.jsxs("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:[i.name,"'s Progress"]}),e.jsxs("p",{className:"hidden text-xs text-gray-500 sm:text-sm md:block md:text-base",children:["You are looking at ",i.name,"'s progress."," ",e.jsx("button",{className:"text-blue-600 underline",onClick:g,children:"View your progress"}),"."]}),e.jsx("p",{className:"block text-gray-500 md:hidden",children:e.jsx("button",{className:"text-blue-600 underline",onClick:g,children:"View your progress."})})]}),e.jsxs("p",{className:`-mx-4 mb-3 flex items-center justify-start border-b border-t px-4 py-2 text-sm sm:hidden ${w?"striped-loader":""}`,children:[e.jsxs("span",{className:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:y}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:c})," of ",e.jsx("span",{children:b})," done"]})]}),e.jsxs("p",{className:`-mx-4 mb-3 hidden items-center justify-center border-b border-t py-2 text-sm sm:flex ${w?"striped-loader":""}`,children:[e.jsxs("span",{className:"mr-2.5 block rounded-sm bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:y}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:c})," completed"]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{"data-progress-learning":"",children:p})," in progress"]}),x>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{"data-progress-skipped":"",children:x})," skipped"]})]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{"data-progress-total":"",children:b})," Total"]})]})]})]})}function le(N){const{resourceId:n,member:i,resourceType:d,onShowMyProgress:w,teamId:g,onClose:f}=N,c=O()?.email===i.email,p=l.useRef(null),x=l.useRef(null),[C,b]=l.useState(!1),[y,m]=l.useState(),[P,k]=l.useState(!0),L=F();let v="https://roadmap.sh";d==="roadmap"?v+=`/${n}.json`:v+=`/best-practices/${n}.json`;async function S(s,r,t,o){const{error:a,response:u}=await _(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-get-member-resource-progress/${s}/${r}?resourceType=${t}&resourceId=${o}`);if(a||!u){L.error(a?.message||"Failed to get member progress");return}return m(u),u}async function M(s){const t=await(await fetch(s,{})).json(),o=await X(t,{fontURL:"/fonts/balsamiq.woff2"});q(p.current,o)}A("Escape",()=>{C||f()}),U(x,()=>{C||f()}),l.useEffect(()=>{!p.current||!v||!n||!d||!g||(k(!0),Promise.all([M(v),S(g,i._id,d,n)]).then(([s,r={}])=>{const{removed:t=[],done:o=[],learning:a=[],skipped:u=[]}=r;o.forEach(j=>h(j,"done")),a.forEach(j=>h(j,"learning")),u.forEach(j=>h(j,"skipped")),t.forEach(j=>h(j,"removed"))}).catch(s=>{console.error(s),L.error(s?.message||"Something went wrong. Please try again!")}).finally(()=>{k(!1)}))},[i]);function R(s,r){!n||!d||!c||(D.set("Updating progress"),B({resourceId:n,resourceType:d,topicId:s},r).then(()=>{h(s,r),S(g,i._id,d,n).then(t=>{m(t)})}).catch(t=>{alert("Something went wrong, please try again."),console.error(t)}).finally(()=>{D.set("")}))}async function T(s){const r=s.target?.closest("g");if(!r)return;const t=r.dataset?r.dataset.groupId:"";if(!t)return;const o=t.replace(/^\d+-/,"");if(r.classList.contains("removed")){s.preventDefault();return}s.preventDefault();const a=r?.classList.contains("done");R(o,a?"pending":"done")}async function I(s){const r=s.target?.closest("g");if(!r)return;const t=r.dataset?r.dataset.groupId:"";if(!t)return;const o=t.replace(/^\d+-/,"");if(r.classList.contains("removed"))return;s.preventDefault();const a=r.classList.contains("learning"),u=r.classList.contains("skipped");if(s.shiftKey){s.preventDefault(),R(o,a?"pending":"learning");return}if(s.altKey){s.preventDefault(),R(o,u?"pending":"skipped");return}}return l.useEffect(()=>{if(!(!i||!p.current))return p.current?.addEventListener("contextmenu",T),p.current?.addEventListener("click",I),()=>{p.current?.removeEventListener("contextmenu",T),p.current?.removeEventListener("click",I)}},[i]),e.jsx("div",{className:"fixed left-0 right-0 top-0 z-[100] h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e.jsx("div",{id:"customized-roadmap",className:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e.jsxs("div",{ref:x,className:"popup-body relative rounded-lg bg-white pt-[1px] shadow",children:[e.jsx(V,{resourceId:n,member:i,progress:y,isCurrentUser:c,onShowMyProgress:w,isLoading:P}),e.jsx("div",{id:"resource-svg-wrap",ref:p,className:"px-4 pb-2"}),P&&e.jsx("div",{className:"flex w-full justify-center",children:e.jsx($,{isDualRing:!1,className:"mb-4 mt-2 h-4 w-4 animate-spin fill-blue-600 text-gray-200 sm:h-8 sm:w-8"})}),e.jsxs("button",{type:"button",className:`absolute right-2.5 top-3 ml-auto inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:text-gray-900 lg:hidden ${c?"hover:bg-gray-800":"hover:bg-gray-100"}`,onClick:f,children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close modal"})]})]})})})}function ce(N){const{resourceId:n,member:i,resourceType:d,onShowMyProgress:w,teamId:g,onClose:f}=N,c=O()?.email===i.email,p=l.useRef(null),[x,C]=l.useState(null),[b,y]=l.useState(),[m,P]=l.useState(!0),k=F();A("Escape",()=>f()),U(p,()=>f());async function L(s,r,t,o){const{error:a,response:u}=await _(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-get-member-resource-progress/${s}/${r}?resourceType=${t}&resourceId=${o}`);if(a||!u){k.error(a?.message||"Failed to get member progress");return}return y(u),u}async function v(){const{response:s,error:r}=await _(`${{BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,SITE:"https://roadmap.sh/",ASSETS_PREFIX:void 0}.PUBLIC_API_URL}/v1-get-roadmap/${n}`);if(r||!s){k.error(r?.message||"Failed to load roadmap");return}return C(s),s}l.useEffect(()=>{!n||!d||!g||(P(!0),Promise.all([v(),L(g,i._id,d,n)]).then(()=>{}).catch(s=>{console.error(s),k.error(s?.message||"Something went wrong. Please try again!")}).finally(()=>{P(!1)}))},[i]);function S(s,r){!n||!d||!c||(D.set("Updating progress"),B({resourceId:n,resourceType:d,topicId:s},r).then(()=>{h(s,r),L(g,i._id,d,n).then(t=>{y(t)})}).catch(t=>{alert("Something went wrong, please try again."),console.error(t)}).finally(()=>{D.set("")}))}const M=l.useCallback((s,r)=>{if(!c)return;const t=s?.currentTarget;if(!t)return;const o=t?.classList.contains("done");S(r.id,o?"pending":"done")},[]),R=l.useCallback((s,r)=>{if(!c)return;const t=s?.currentTarget;if(!t)return;const o=t?.classList.contains("learning");S(r.id,o?"pending":"learning")},[]),T=l.useCallback((s,r)=>{if(!c)return;const t=s?.currentTarget;if(!t)return;const o=t?.classList.contains("skipped");S(r.id,o?"pending":"skipped")},[]),I=l.useCallback((s,r)=>{if(!r||!c)return;r.startsWith("http")?window.open(r,"_blank"):window.location.href=r},[]);return e.jsx("div",{className:"fixed left-0 right-0 top-0 z-[100] h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e.jsx("div",{id:"original-roadmap",className:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e.jsxs("div",{className:"relative rounded-lg bg-white pt-[1px] shadow",ref:p,children:[e.jsx(V,{resourceId:n,member:i,progress:b,isCurrentUser:c,onShowMyProgress:w,isLoading:m}),!m&&x&&e.jsx("div",{className:"px-4 pb-2",children:e.jsx(G,{variant:"modal",hasMinimap:!1,roadmap:x,className:"min-h-[400px]",onRendered:()=>{const{removed:s=[],done:r=[],learning:t=[],skipped:o=[]}=b||{};r.forEach(a=>h(a,"done")),t.forEach(a=>h(a,"learning")),o.forEach(a=>h(a,"skipped")),s.forEach(a=>h(a,"removed"))},onTopicRightClick:M,onTopicShiftClick:R,onTopicAltClick:T,onButtonNodeClick:I,onLinkClick:I,fontFamily:"Balsamiq Sans",fontURL:"/fonts/balsamiq.woff2"})}),m&&e.jsx("div",{className:"flex w-full justify-center",children:e.jsx($,{isDualRing:!1,className:"mb-4 mt-2 h-4 w-4 animate-spin fill-blue-600 text-gray-200 sm:h-8 sm:w-8"})}),e.jsxs("button",{type:"button",className:`absolute right-2.5 top-3 z-50 ml-auto inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:text-gray-900 lg:hidden ${c?"hover:bg-gray-800":"hover:bg-gray-100"}`,onClick:f,children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close modal"})]})]})})})}export{le as M,ce as a};
