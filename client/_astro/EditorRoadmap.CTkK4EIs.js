import{j as o}from"./jsx-runtime.CAnB4H9Z.js";import{r as d}from"./index.qVDZzPEr.js";/* empty css                       */import{r as L,u as S,a as C,b as N,d as P}from"./resource-progress.D0zUEWjd.js";import{p as w}from"./page.BgB1PChG.js";import{u as I}from"./use-toast.CP_0jytG.js";import{i as y}from"./jwt.CBjnGchD.js";import{s as v}from"./popup.CdCAhVM2.js";import{S as T}from"./Spinner.xsriOokz.js";import{b as D}from"./http.DleWH6fe.js";import{ProgressNudge as G}from"./ProgressNudge.ChCzftIb.js";import{g as $}from"./browser.t5_cZ6DD.js";import"./roadmap.BEsVk7__.js";import"./index.BRGkBvr2.js";import"./index.DgoachrA.js";import"./toast.CxFvZIRu.js";import"./classname.BR_JCrAi.js";import"./index.BVW7W7Ao.js";function z(a){return o.jsxs("div",{className:"fixed bottom-0 left-0 right-0 top-0 z-[9999] border bg-white p-5 text-black",children:[o.jsx("h2",{className:"mb-2 text-xl font-semibold",children:"Private Component"}),o.jsx("p",{className:"mb-4",children:"Renderer is a private component. If you are a collaborator and have access to it. Run the following command:"}),o.jsx("code",{className:"mt-5 rounded-md bg-gray-800 p-2 text-white",children:"npm run generate-renderer"})]})}const A=/[^A-Za-z0-9_\- ]/g;function F(a){return typeof a!="string"?"":a.toLowerCase().replace(A,"").trim().replace(/ /g,"-")}function b(a){const e=a?.closest("g")||{},l=e?.dataset?.nodeId,i=e?.dataset?.type,r=e?.dataset?.title;return!l||!i?null:{nodeId:l,nodeType:i,targetGroup:e,title:r}}const R=["topic","subtopic","button","link-item"];function K(a){const{resourceId:e,nodes:l=[],edges:i=[]}=a,r=d.useRef(null),h=I();async function m(t,c){w.set("Updating progress"),S({resourceId:e,resourceType:"roadmap",topicId:t},c).then(()=>{C(t,c)}).catch(s=>{h.error("Something went wrong, please try again."),console.error(s)}).finally(()=>{w.set(""),N()})}const f=d.useCallback(t=>{const c=t.target,{nodeId:s,nodeType:n,targetGroup:p,title:u}=b(c)||{};if(!s||!n||!R.includes(n))return;if(n==="button"||n==="link-item"){const x=p?.dataset?.link||"";x.startsWith("http")?window.open(x,"_blank"):window.location.href=x;return}const k=p?.classList.contains("learning"),j=p?.classList.contains("skipped");if(t.shiftKey){if(t.preventDefault(),!y()){v();return}m(s,k?"pending":"learning");return}else if(t.altKey){if(t.preventDefault(),!y()){v();return}m(s,j?"pending":"skipped");return}if(!u)return;const E=`${F(u)}@${s}`;window.dispatchEvent(new CustomEvent("roadmap.node.click",{detail:{topicId:E,resourceId:e,resourceType:"roadmap"}}))},[]),g=d.useCallback(t=>{t.preventDefault();const c=t.target,{nodeId:s,nodeType:n,targetGroup:p}=b(c)||{};if(!s||!n||!R.includes(n)||n==="button")return;if(!y()){v();return}const u=p?.classList.contains("done");m(s,u?"pending":"done")},[]);return d.useEffect(()=>{if(r?.current)return r?.current?.addEventListener("click",f),r?.current?.addEventListener("contextmenu",g),()=>{r?.current?.removeEventListener("click",f),r?.current?.removeEventListener("contextmenu",g)}},[]),o.jsx(z,{ref:r,roadmap:{nodes:l,edges:i},onRendered:()=>{r.current?.setAttribute("data-renderer","editor"),L("roadmap",e).finally()}})}function oe(a){const{resourceId:e,resourceType:l="roadmap",dimensions:i}=a,[r,h]=d.useState(!1),[m,f]=d.useState(!0),[g,t]=d.useState(void 0),c=async()=>{f(!0);const{r:n}=$(),{response:p,error:u}=await D(`/${n||e}.json`);if(u){console.error(u);return}t(p),f(!1),h(!!n)};d.useEffect(()=>{P(l,e),c().finally()},[e]);const s=i.width/i.height;return!g||m?o.jsx("div",{style:r?void 0:{"--aspect-ratio":s},className:"flex aspect-[var(--aspect-ratio)] w-full flex-col justify-center",children:o.jsx("div",{className:"flex w-full justify-center",children:o.jsx(T,{innerFill:"#2563eb",outerFill:"#E5E7EB",className:"h-6 w-6 animate-spin sm:h-12 sm:w-12"})})}):o.jsxs("div",{style:r?void 0:{"--aspect-ratio":s},className:"flex aspect-[var(--aspect-ratio)] w-full flex-col justify-center",children:[o.jsx(K,{...g,dimensions:i,resourceId:e}),o.jsx(G,{resourceId:e,resourceType:l})]})}export{oe as EditorRoadmap};
