import{a as h}from"./index.DgoachrA.js";const T=5,r=6,m=10;let c=(e,s,t,f)=>(e.events=e.events||{},e.events[t+m]||(e.events[t+m]=f(n=>{e.events[t].reduceRight((i,l)=>(l(i),i),{shared:{},...n})})),e.events[t]=e.events[t]||[],e.events[t].push(s),()=>{let n=e.events[t],i=n.indexOf(s);n.splice(i,1),n.length||(delete e.events[t],e.events[t+m](),delete e.events[t+m])}),g=1e3,O=(e,s)=>c(e,f=>{let n=s(f);n&&e.events[r].push(n)},T,f=>{let n=e.listen;e.listen=(...l)=>(!e.lc&&!e.active&&(e.active=!0,f()),n(...l));let i=e.off;return e.events[r]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let l of e.events[r])l();e.events[r]=[]}},g)},()=>{e.listen=n,e.off=i}}),M=(e,s,t)=>{Array.isArray(e)||(e=[e]);let f,n=0,i=()=>{let a=e.map(u=>u.get());if(f===void 0||a.some((u,d)=>u!==f[d])){let u=++n;f=a;let d=s(...a);d&&d.then&&d.t?d.then(v=>{u===n&&l.set(v)}):l.set(d)}},l=h(void 0,Math.max(...e.map(a=>a.l))+1),p=i;return O(l,()=>{let a=e.map(u=>u.listen(p,-1/l.l));return i(),()=>{for(let u of a)u()}}),l},U=(e,s)=>M(e,s);export{U as c};
