<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/mongodb/content/110-mongodb-security/101-x509-certificate-auth.md"></div> <h1 id="x509-certificate-auth">X.509 Certificate Auth</h1>
<p>X.509 certificate authentication is a crucial aspect of MongoDB security that enables clients to verify each other’s authenticity using public key infrastructure (PKI). With X.509 certificate authentication, both the client and MongoDB server confirm the identity of the other party, ensuring secure communication and preventing unauthorized access.</p>
<h2 id="implementing-x509-certificate-authentication">Implementing X.509 Certificate Authentication</h2>
<p>To incorporate x.509 certificate authentication, follow these steps:</p>
<ul>
<li>
<p><strong>Obtain Certificates</strong>: Get an X.509 certificate for the server and each client that connects to the MongoDB server. The certificates must be issued by a single Certificate Authority (CA).</p>
</li>
<li>
<p><strong>Configure the MongoDB Server</strong>: To enable X.509 authentication, you’ll need to start MongoDB with the following options:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">mongod</span><span style="color:#BD93F9"> --tlsMode</span><span style="color:#F1FA8C"> requireTLS</span><span style="color:#BD93F9"> --tlsCertificateKeyFile</span><span style="color:#F1FA8C"> /path/to/server.pem</span><span style="color:#BD93F9"> --tlsCAFile</span><span style="color:#F1FA8C"> /path/to/ca.pem</span><span style="color:#BD93F9"> --auth</span></span>
<span class="line"></span></code></pre>
<p>Replace <code>/path/to/server.pem</code> with the path to the MongoDB server certificate file and <code>/path/to/ca.pem</code> with the CA certificate file. Add <code>--auth</code> to require authentication for all connections.</p>
</li>
<li>
<p><strong>Create the User Administrator</strong>: Use the following command on the <code>admin</code> database to create a user administrator with an X.509 certificate:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F8F8F2">db.</span><span style="color:#50FA7B">getSiblingDB</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">$external</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">).</span><span style="color:#50FA7B">runCommand</span><span style="color:#F8F8F2">({</span></span>
<span class="line"><span style="color:#F8F8F2">  createUser</span><span style="color:#FF79C6">:</span></span>
<span class="line"><span style="color:#E9F284">    '</span><span style="color:#F1FA8C">C=US,ST=New York,L=New York City,O=MongoDB,OU=kerneluser,CN=client@example.com</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">  roles</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> [</span></span>
<span class="line"><span style="color:#F8F8F2">    { role</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">userAdminAnyDatabase</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, db</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">admin</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2"> },</span></span>
<span class="line"><span style="color:#F8F8F2">    { role</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">clusterAdmin</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, db</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">admin</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2"> },</span></span>
<span class="line"><span style="color:#F8F8F2">    { role</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">readWriteAnyDatabase</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, db</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">admin</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2"> },</span></span>
<span class="line"><span style="color:#F8F8F2">    { role</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">dbAdminAnyDatabase</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, db</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">admin</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2"> },</span></span>
<span class="line"><span style="color:#F8F8F2">  ],</span></span>
<span class="line"><span style="color:#F8F8F2">  writeConcern</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> { w</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">majority</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, wtimeout</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 5000</span><span style="color:#F8F8F2"> },</span></span>
<span class="line"><span style="color:#F8F8F2">});</span></span>
<span class="line"></span></code></pre>
<p>Replace the <code>createUser</code> field with your X.509 certificate’s subject.</p>
</li>
<li>
<p><strong>Authenticate with the Client Certificate</strong>: To authenticate the client, use a <code>mongo</code> shell command that includes the client certificate and CA certificate files:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">mongo</span><span style="color:#BD93F9"> --tls</span><span style="color:#BD93F9"> --tlsCertificateKeyFile</span><span style="color:#F1FA8C"> /path/to/client.pem</span><span style="color:#BD93F9"> --tlsCAFile</span><span style="color:#F1FA8C"> /path/to/ca.pem</span><span style="color:#BD93F9"> --authenticationDatabase</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">$external</span><span style="color:#E9F284">'</span><span style="color:#BD93F9"> --authenticationMechanism</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">MONGODB-X509</span><span style="color:#E9F284">'</span><span style="color:#BD93F9"> --host</span><span style="color:#F1FA8C"> hostname.example.com</span></span>
<span class="line"></span></code></pre>
<p>Update <code>/path/to/client.pem</code> with the client certificate file path and <code>/path/to/ca.pem</code> with the CA certificate file. Replace <code>hostname.example.com</code> with your MongoDB server’s hostname.</p>
</li>
</ul>
<p>After successfully implementing these steps, you will have enabled X.509 certificate authentication for your MongoDB environment, providing an added layer of security for client-server communications.</p>