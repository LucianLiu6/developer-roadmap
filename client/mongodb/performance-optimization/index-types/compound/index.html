<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/mongodb/content/105-performance-optimization/index-types/103-compound.md"></div> <h1 id="compound">Compound</h1>
<p>A compound index is a type of index in MongoDB that allows you to specify multiple fields in a single index, effectively creating an index on the combined values of those fields. This type of index can support queries that involve multiple fields, allowing you to optimize the performance of your queries and efficiently search through large datasets.</p>
<h2 id="structure">Structure</h2>
<p>To create a compound index, you specify each field and its corresponding sort order (ascending/descending) as an object:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    field1: &#x3C;</span><span style="color:#FF79C6">sort</span><span style="color:#50FA7B;font-style:italic"> order</span><span style="color:#F8F8F2">>,</span></span>
<span class="line"><span style="color:#F8F8F2">    field2: &#x3C;</span><span style="color:#FF79C6">sort</span><span style="color:#50FA7B;font-style:italic"> order</span><span style="color:#F8F8F2">>,</span></span>
<span class="line"><span style="color:#F8F8F2">    ...</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre>
<p>For example, to create a compound index on the <code>author</code> field in ascending order and the <code>title</code> field in descending order, you would use:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">  author: </span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">  title: </span><span style="color:#FF79C6">-</span><span style="color:#BD93F9">1</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre>
<h2 id="usage">Usage</h2>
<p>When using a compound index, consider the following:</p>
<ul>
<li>
<p><strong>Prefixes</strong>: A compound index can support queries on any of its “prefixes”, which are subsets of its fields starting from the left. For example, if a collection has a compound index <code>{ author: 1, title: -1 }</code>, it can support queries on both the <code>author</code> field and the combined <code>author</code> and <code>title</code> fields.</p>
</li>
<li>
<p><strong>Sort Order</strong>: The sort order of fields in the compound index can affect query performance. In general, choose the sort order based on your application’s query patterns.</p>
</li>
<li>
<p><strong>Covered Queries</strong>: A compound index can also be used to perform “covered queries”, where all the fields of the query are part of the index. In such a case, MongoDB can satisfy the query using only the index, without the need to access the actual documents, resulting in improved performance.</p>
</li>
</ul>
<h2 id="example">Example</h2>
<p>Suppose you have a collection named <code>books</code> with the following documents:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F8F8F2">{ </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">_id</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2"> : </span><span style="color:#50FA7B">ObjectId</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">...</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">), </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">author</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2"> : </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">John Smith</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">title</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2"> : </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Introduction to MongoDB</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">year</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2"> : </span><span style="color:#BD93F9">2020</span><span style="color:#F8F8F2"> }</span></span>
<span class="line"><span style="color:#F8F8F2">{ </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">_id</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2"> : </span><span style="color:#50FA7B">ObjectId</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">...</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">), </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">author</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2"> : </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Jane Doe</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">title</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2"> : </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">Advanced MongoDB</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">year</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2"> : </span><span style="color:#BD93F9">2021</span><span style="color:#F8F8F2"> }</span></span>
<span class="line"><span style="color:#F8F8F2">{ </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">_id</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2"> : </span><span style="color:#50FA7B">ObjectId</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">...</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">), </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">author</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2"> : </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">John Smith</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">title</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2"> : </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">MongoDB for Experts</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">year</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2"> : </span><span style="color:#BD93F9">2021</span><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span></code></pre>
<p>You can create a compound index on the <code>author</code> and <code>title</code> fields using the following command:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F8F8F2">db.books.</span><span style="color:#50FA7B">createIndex</span><span style="color:#F8F8F2">({ author</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">, title</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2"> });</span></span>
<span class="line"></span></code></pre>
<p>With the compound index in place, MongoDB can efficiently execute queries involving both the <code>author</code> and <code>title</code> fields. For example, the following query would benefit from the compound index:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F8F8F2">db.books.</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">({ author</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">John Smith</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, title</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">Introduction to MongoDB</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2"> });</span></span>
<span class="line"></span></code></pre>
<p>In addition, the query could use the index for sorting results:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F8F8F2">db.books.</span><span style="color:#50FA7B">find</span><span style="color:#F8F8F2">({ author</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">John Smith</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2"> }).</span><span style="color:#50FA7B">sort</span><span style="color:#F8F8F2">({ title</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2"> });</span></span>
<span class="line"></span></code></pre>
<p>In summary, compound indexes provide a powerful optimization tool for queries involving multiple fields, allowing MongoDB to execute searches more efficiently and improve overall performance.</p>