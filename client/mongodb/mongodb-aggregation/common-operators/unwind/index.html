<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/mongodb/content/106-mongodb-aggregation/101-common-operators/106-unwind.md"></div> <h1 id="unwind">$unwind</h1>
<p>The <code>$unwind</code> operator is a powerful aggregation pipeline stage in MongoDB that allows you to deconstruct an array field from input documents and generate a new document for each element in the array, essentially “unwinding” the array.</p>
<p>This operator is particularly useful when you have documents containing array fields, and you need to perform operations on the individual elements within those arrays. <code>$unwind</code> enables you to flatten the array structure and easily manipulate or analyze data within arrays as separate documents.</p>
<h2 id="syntax">Syntax</h2>
<p>The general syntax for the <code>$unwind</code> operator is:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">  $unwind: {</span></span>
<span class="line"><span style="color:#F8F8F2">    path: &#x3C;</span><span style="color:#FF79C6">field</span><span style="color:#50FA7B;font-style:italic"> path</span><span style="color:#F8F8F2">>,</span></span>
<span class="line"><span style="color:#F8F8F2">    includeArrayIndex: &#x3C;</span><span style="color:#FF79C6">string</span><span style="color:#F8F8F2">>, // Optional</span></span>
<span class="line"><span style="color:#F8F8F2">    preserveNullAndEmptyArrays: &#x3C;</span><span style="color:#FF79C6">boolean</span><span style="color:#F8F8F2">> // Optional</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre>
<h2 id="parameters">Parameters</h2>
<ul>
<li><code>path</code>: A string representing the field path of the array you want to unwind. It must be prefixed with a <code>$</code> to indicate referencing a field in the input document.</li>
<li><code>includeArrayIndex</code>: (Optional) A string representing the field name for the index of the array element. The output documents will include this field, with the value as the index of the element in the original array.</li>
<li><code>preserveNullAndEmptyArrays</code>: (Optional) A boolean value that determines whether to output a document for input documents that don’t have the specified <code>path</code> or have an empty array, null, or missing value. By default, these input documents are not included in the output.</li>
</ul>
<h2 id="example">Example</h2>
<p>Consider a <code>sales</code> collection with the following sample document:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">  _id: </span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">  item: </span><span style="color:#E9F284">"</span><span style="color:#F1FA8C">itemA</span><span style="color:#E9F284">"</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">  orders: [</span></span>
<span class="line"><span style="color:#F8F8F2">    { quantity</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">, unitPrice</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 10</span><span style="color:#F8F8F2"> },</span></span>
<span class="line"><span style="color:#F8F8F2">    { quantity</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 3</span><span style="color:#F8F8F2">, unitPrice</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 20</span><span style="color:#F8F8F2"> },</span></span>
<span class="line"><span style="color:#F8F8F2">    { quantity</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">, unitPrice</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 15</span><span style="color:#F8F8F2"> }</span></span>
<span class="line"><span style="color:#F8F8F2">  ]</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre>
<p>If you want to calculate the total revenue for each individual order, you can use the <code>$unwind</code> operator to deconstruct the <code>orders</code> array:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F8F8F2">db.sales.</span><span style="color:#50FA7B">aggregate</span><span style="color:#F8F8F2">([{ $unwind</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> { path</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">$orders</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2"> } }]);</span></span>
<span class="line"></span></code></pre>
<p>The output will be:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F8F8F2">[</span></span>
<span class="line"><span style="color:#F8F8F2">  { _id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">, item</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">itemA</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, orders</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> { quantity</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 2</span><span style="color:#F8F8F2">, unitPrice</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 10</span><span style="color:#F8F8F2"> } },</span></span>
<span class="line"><span style="color:#F8F8F2">  { _id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">, item</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">itemA</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, orders</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> { quantity</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 3</span><span style="color:#F8F8F2">, unitPrice</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 20</span><span style="color:#F8F8F2"> } },</span></span>
<span class="line"><span style="color:#F8F8F2">  { _id</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">, item</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">itemA</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, orders</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> { quantity</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 1</span><span style="color:#F8F8F2">, unitPrice</span><span style="color:#FF79C6">:</span><span style="color:#BD93F9"> 15</span><span style="color:#F8F8F2"> } },</span></span>
<span class="line"><span style="color:#F8F8F2">];</span></span>
<span class="line"></span></code></pre>
<p>Now each document represents a single order, and you can easily perform further operations like calculating the revenue for each document.</p>
<p>Remember, the <code>$unwind</code> operator is a crucial tool for handling and analyzing array data in MongoDB, enabling you to efficiently work with complex data structures.</p>