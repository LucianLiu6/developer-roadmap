<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/mongodb/content/106-mongodb-aggregation/index.md"></div> <h1 id="mongodb-aggregation">MongoDB Aggregation</h1>
<p>MongoDB Aggregation framework provides a way to process and transform data that is stored in our MongoDB collections. It allows you to perform calculations and return the calculated results using various data aggregation tools such as aggregation pipelines, map-reduce functions, or single-purpose aggregation methods.</p>
<p><strong>Here is a brief summary of MongoDB Aggregation:</strong></p>
<h2 id="aggregation-pipeline">Aggregation Pipeline</h2>
<p>The aggregation pipeline is a framework in MongoDB that enables the developers to execute a series of data transformations on the documents in a collection. The pipeline consists of multiple stages, and each stage applies a specific operation on the input documents. Among these operations, you can find features like filtering, sorting, projecting, and grouping.</p>
<p>Example of a simple aggregation pipeline:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F8F8F2">db.collection.</span><span style="color:#50FA7B">aggregate</span><span style="color:#F8F8F2">([</span></span>
<span class="line"><span style="color:#F8F8F2">  { $match</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> { status</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">A</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2"> } },</span></span>
<span class="line"><span style="color:#F8F8F2">  { $group</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> { _id</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">$cust_id</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, total</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> { $sum</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">$amount</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2"> } } },</span></span>
<span class="line"><span style="color:#F8F8F2">  { $sort</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> { total</span><span style="color:#FF79C6">:</span><span style="color:#FF79C6"> -</span><span style="color:#BD93F9">1</span><span style="color:#F8F8F2"> } },</span></span>
<span class="line"><span style="color:#F8F8F2">]);</span></span>
<span class="line"></span></code></pre>
<h2 id="map-reduce">Map-Reduce</h2>
<p>Map-Reduce is another method to aggregate data in MongoDB. It involves defining a map function to extract data from the input documents, which emits key-value pairs. A reduce function combines the emitted data by keys and optionally a finalize function to further process the results.</p>
<p>Example of a simple map-reduce function:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F8F8F2">db.collection.</span><span style="color:#50FA7B">mapReduce</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#FF79C6">  function</span><span style="color:#F8F8F2"> () {</span></span>
<span class="line"><span style="color:#50FA7B">    emit</span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">.cust_id, </span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">.amount);</span></span>
<span class="line"><span style="color:#F8F8F2">  },</span></span>
<span class="line"><span style="color:#FF79C6">  function</span><span style="color:#F8F8F2"> (</span><span style="color:#FFB86C;font-style:italic">key</span><span style="color:#F8F8F2">, </span><span style="color:#FFB86C;font-style:italic">values</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#F8F8F2"> Array.</span><span style="color:#50FA7B">sum</span><span style="color:#F8F8F2">(values);</span></span>
<span class="line"><span style="color:#F8F8F2">  },</span></span>
<span class="line"><span style="color:#F8F8F2">  {</span></span>
<span class="line"><span style="color:#F8F8F2">    query</span><span style="color:#FF79C6">:</span><span style="color:#F8F8F2"> { status</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">A</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2"> },</span></span>
<span class="line"><span style="color:#F8F8F2">    out</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">order_totals</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#F8F8F2">  }</span></span>
<span class="line"><span style="color:#F8F8F2">);</span></span>
<span class="line"></span></code></pre>
<h2 id="single-purpose-aggregation">Single-Purpose Aggregation</h2>
<p>MongoDB also supports single-purpose aggregation methods, such as <code>db.collection.count()</code>, <code>db.collection.distinct()</code>, and <code>db.collection.group()</code> etc. These methods offer a faster and more convenient way to perform simple aggregations directly.</p>
<p>Example of db.collection.count():</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F8F8F2">db.collection.</span><span style="color:#50FA7B">count</span><span style="color:#F8F8F2">({ status</span><span style="color:#FF79C6">:</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">A</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2"> });</span></span>
<span class="line"></span></code></pre>
<p>In conclusion, MongoDB Aggregation is a powerful feature that helps you extract, manipulate and aggregate data from your collections. By using aggregation pipelines, map-reduce functions or single-purpose aggregation methods, you can perform various data analysis tasks efficiently on your MongoDB dataset.</p>