<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/mongodb/content/107-transactions.md"></div> <h1 id="transactions">Transactions</h1>
<p><strong>Transactions</strong> play a vital role in maintaining data consistency and integrity within a database. They represent a single unit of work that consists of multiple operations executed in a sequence. In this section, we’ll discuss the concept of transactions in MongoDB, their usage, and how they help in accomplishing various operations.</p>
<h2 id="overview">Overview</h2>
<p>MongoDB supports multi-document transactions, enabling you to perform multiple read and write operations across several documents within a single, atomic transaction. A transaction might involve several operations, for instance:</p>
<ul>
<li>Creating a new document</li>
<li>Updating an existing document</li>
<li>Deleting a document</li>
<li>Reading documents</li>
</ul>
<p>The fundamental purpose of a transaction is to either execute <strong>all</strong> or <strong>none</strong> of its operations. This means that, in case any operation within the transaction fails, the entire transaction will be aborted, and the database will return to its initial state, thus ensuring data consistency.</p>
<p>Transactions in MongoDB are essential to achieve the following <strong>ACID</strong> properties:</p>
<ul>
<li><strong>Atomicity</strong>: Ensures that either all the operations in the transaction are executed, or none are.</li>
<li><strong>Consistency</strong>: Guarantees that, upon completing a transaction, the database remains in a consistent state.</li>
<li><strong>Isolation</strong>: Secures that the operations within the transaction are isolated from other transactions being executed simultaneously.</li>
<li><strong>Durability</strong>: Warrants that once a transaction is successfully completed, its effects will be stored persistently in the database.</li>
</ul>
<h2 id="usage">Usage</h2>
<p>To begin a transaction in MongoDB, you’ll need to obtain a session and then start the transaction using the <code>startTransaction()</code> method. After performing the necessary operations, you may <code>commit</code> the transaction to apply the changes to the database, or <code>abort</code> to discard the changes.</p>
<p>Here’s an example to illustrate transactions:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#6272A4">// Start a session</span></span>
<span class="line"><span style="color:#FF79C6">const</span><span style="color:#F8F8F2"> session </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> client.</span><span style="color:#50FA7B">startSession</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">// Start a transaction within the session</span></span>
<span class="line"><span style="color:#F8F8F2">session.</span><span style="color:#50FA7B">startTransaction</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">try</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">  // Perform various operations within the transaction</span></span>
<span class="line"><span style="color:#FF79C6">  const</span><span style="color:#F8F8F2"> operation1 </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> await</span><span style="color:#F8F8F2"> collection1.</span><span style="color:#50FA7B">insertOne</span><span style="color:#F8F8F2">(doc1, { session });</span></span>
<span class="line"><span style="color:#FF79C6">  const</span><span style="color:#F8F8F2"> operation2 </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> await</span><span style="color:#F8F8F2"> collection2.</span><span style="color:#50FA7B">updateOne</span><span style="color:#F8F8F2">(condition, update, {</span></span>
<span class="line"><span style="color:#F8F8F2">    session,</span></span>
<span class="line"><span style="color:#F8F8F2">  });</span></span>
<span class="line"><span style="color:#FF79C6">  const</span><span style="color:#F8F8F2"> operation3 </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> await</span><span style="color:#F8F8F2"> collection3.</span><span style="color:#50FA7B">deleteOne</span><span style="color:#F8F8F2">(doc3, { session });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">  // Commit the transaction</span></span>
<span class="line"><span style="color:#FF79C6">  await</span><span style="color:#F8F8F2"> session.</span><span style="color:#50FA7B">commitTransaction</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">} </span><span style="color:#FF79C6">catch</span><span style="color:#F8F8F2"> (error) {</span></span>
<span class="line"><span style="color:#6272A4">  // If any operation fails, abort the transaction</span></span>
<span class="line"><span style="color:#FF79C6">  await</span><span style="color:#F8F8F2"> session.</span><span style="color:#50FA7B">abortTransaction</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">} </span><span style="color:#FF79C6">finally</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">  // End the session</span></span>
<span class="line"><span style="color:#F8F8F2">  session.</span><span style="color:#50FA7B">endSession</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre>
<h2 id="limitations">Limitations</h2>
<p>While transactions provide immense benefits regarding data consistency and integrity, it is vital to be aware of some of its limitations:</p>
<ul>
<li>They are available only in MongoDB versions 4.0 and above.</li>
<li>They can cause performance overhead, especially for write-heavy workloads.</li>
<li>In MongoDB clusters, transactions only support a maximum duration of 60 seconds.</li>
</ul>
<p>In summary, transactions are a powerful feature of MongoDB, ensuring data integrity, and consistency in the database. By understanding their usage and implications, you can effectively utilize them in your application according to your specific requirements.</p>