<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/postgresql-dba/content/112-sql-optimization-techniques/100-indexes-usecases/102-gist.md"></div> <h1 id="gist-indexes">GIST Indexes</h1>
<p>The Generalized Search Tree (GiST) is a powerful and flexible index type in PostgreSQL that serves as a framework to implement different indexing strategies. GiST provides a generic infrastructure for building custom indexes, extending the core capabilities of PostgreSQL.</p>
<h3 id="overview">Overview</h3>
<p>GiST indexes are especially useful in the following scenarios:</p>
<ul>
<li>Geometric and spatial data, for example, searching for nearby locations or finding overlapping ranges.</li>
<li>Text search in combination with the <code>tsvector</code> and <code>tsquery</code> types, such as full-text search on documents.</li>
<li>Custom data types where the built-in index types (B-tree, Hash, etc.) are not efficient or applicable.</li>
</ul>
<h3 id="key-features">Key Features</h3>
<ul>
<li><strong>Flexible</strong>: GiST allows implementing a wide range of indexing solutions, from geometric operations to text search.</li>
<li><strong>Composable</strong>: You can combine several index conditions in a single query, providing richer search capabilities.</li>
<li><strong>Extensible</strong>: GiST supports custom data types and operators, enabling you to tailor your indexing strategy to your specific use case.</li>
</ul>
<h3 id="example-usage">Example Usage</h3>
<h4 id="spatial-data">Spatial Data</h4>
<p>Let’s say you have a table <code>locations</code> with columns <code>id</code>, <code>name</code>, and <code>point</code> (a PostgreSQL geometric data type representing a 2D point with X and Y coordinates). You want to find all locations within a certain radius from a given point.</p>
<p>First, create the GiST index on the <code>point</code> column:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#FF79C6">CREATE</span><span style="color:#FF79C6"> INDEX</span><span style="color:#50FA7B"> locations_point_gist</span><span style="color:#FF79C6"> ON</span><span style="color:#F8F8F2"> locations </span><span style="color:#FF79C6">USING</span><span style="color:#F8F8F2"> gist(</span><span style="color:#FF79C6">point</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span></code></pre>
<p>Now, you can efficiently find all locations within a certain radius (e.g., 5 units) from a given point (e.g., <code>(3, 4)</code>):</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#FF79C6">SELECT</span><span style="color:#FF79C6"> *</span><span style="color:#FF79C6"> FROM</span><span style="color:#F8F8F2"> locations </span></span>
<span class="line"><span style="color:#FF79C6">WHERE</span><span style="color:#FF79C6"> point</span><span style="color:#FF79C6"> &#x3C;-></span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">(3, 4)</span><span style="color:#E9F284">'</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#BD93F9"> 5</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span></code></pre>
<h4 id="text-search">Text Search</h4>
<p>If you want to use GiST for full-text search, first create a <code>tsvector</code> column in your table (e.g., <code>documents</code>) to store the parsed tokens from your original text column (e.g., <code>content</code>):</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#FF79C6">ALTER</span><span style="color:#FF79C6"> TABLE</span><span style="color:#F8F8F2"> documents </span><span style="color:#FF79C6">ADD</span><span style="color:#F8F8F2"> COLUMN content_vector tsvector;</span></span>
<span class="line"><span style="color:#FF79C6">UPDATE</span><span style="color:#F8F8F2"> documents </span><span style="color:#FF79C6">SET</span><span style="color:#F8F8F2"> content_vector </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> to_tsvector(</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">english</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, content);</span></span>
<span class="line"></span></code></pre>
<p>Then, create the GiST index on the <code>content_vector</code> column:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#FF79C6">CREATE</span><span style="color:#FF79C6"> INDEX</span><span style="color:#50FA7B"> documents_content_gist</span><span style="color:#FF79C6"> ON</span><span style="color:#F8F8F2"> documents </span><span style="color:#FF79C6">USING</span><span style="color:#F8F8F2"> gist(content_vector);</span></span>
<span class="line"></span></code></pre>
<p>Finally, perform full-text search using <code>@@</code> operator and <code>tsquery</code>:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#FF79C6">SELECT</span><span style="color:#FF79C6"> *</span><span style="color:#FF79C6"> FROM</span><span style="color:#F8F8F2"> documents </span></span>
<span class="line"><span style="color:#FF79C6">WHERE</span><span style="color:#F8F8F2"> content_vector @@ to_tsquery(</span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">english</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">, </span><span style="color:#E9F284">'</span><span style="color:#F1FA8C">search query</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span></code></pre>
<h3 id="conclusion">Conclusion</h3>
<p>GiST is a versatile index type in PostgreSQL that accommodates various use cases, including spatial data and full-text search. This powerful indexing framework allows you to extend PostgreSQL’s built-in capabilities, creating custom indexing strategies aligned with your specific requirements.</p>