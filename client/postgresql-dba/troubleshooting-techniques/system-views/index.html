<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/postgresql-dba/content/111-troubleshooting-techniques/100-system-views/index.md"></div> <h1 id="system-views-in-postgresql">System Views in PostgreSQL</h1>
<p>PostgreSQL provides a set of system views that allow you to gain insight into the internal workings of the database. These views can be extremely helpful for troubleshooting and performance tuning as they expose information about various database components such as tables, indexes, schemas, and more. In this section, weâ€™ll explore some of the essential system views and their usage to aid in troubleshooting.</p>
<h3 id="pg_stat_activity">pg_stat_activity</h3>
<p>The <code>pg_stat_activity</code> view provides a real-time snapshot of the current queries being executed by the PostgreSQL server. It can be used to identify long-running queries, locks, or idle sessions. Example usage:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#FF79C6">SELECT</span><span style="color:#F8F8F2"> datname, usename, </span><span style="color:#FF79C6">state</span><span style="color:#F8F8F2">, query </span></span>
<span class="line"><span style="color:#FF79C6">FROM</span><span style="color:#F8F8F2"> pg_stat_activity;</span></span>
<span class="line"></span></code></pre>
<h3 id="pg_stat_user_tables">pg_stat_user_tables</h3>
<p>This view shows statistics about user tables, such as the number of rows inserted, updated, or deleted, the number of sequential scans and index scans, and more. This information can help you identify performance bottlenecks related to specific tables. Example usage:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#FF79C6">SELECT</span><span style="color:#F8F8F2"> relname, seq_scan, idx_scan, n_tup_ins, n_tup_upd, n_tup_del </span></span>
<span class="line"><span style="color:#FF79C6">FROM</span><span style="color:#F8F8F2"> pg_stat_user_tables;</span></span>
<span class="line"></span></code></pre>
<h3 id="pg_stat_user_indexes">pg_stat_user_indexes</h3>
<p>The <code>pg_stat_user_indexes</code> view provides information about the usage of user indexes, such as the number of index scans and the number of rows fetched by them. It helps you identify inefficient or rarely-used indexes. Example usage:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#FF79C6">SELECT</span><span style="color:#F8F8F2"> relname, indexrelname, idx_scan, idx_tup_read, idx_tup_fetch </span></span>
<span class="line"><span style="color:#FF79C6">FROM</span><span style="color:#F8F8F2"> pg_stat_user_indexes;</span></span>
<span class="line"></span></code></pre>
<h3 id="pg_locks">pg_locks</h3>
<p>The <code>pg_locks</code> view displays information about the current locks held within the database. This view is particularly helpful when investigating issues related to deadlocks or contention. Example usage:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#FF79C6">SELECT</span><span style="color:#F8F8F2"> locktype, relation::regclass, mode, granted, query </span></span>
<span class="line"><span style="color:#FF79C6">FROM</span><span style="color:#F8F8F2"> pg_locks l</span></span>
<span class="line"><span style="color:#FF79C6">JOIN</span><span style="color:#F8F8F2"> pg_stat_activity a </span><span style="color:#FF79C6">ON</span><span style="color:#BD93F9"> l</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">pid</span><span style="color:#FF79C6"> =</span><span style="color:#BD93F9"> a</span><span style="color:#F8F8F2">.</span><span style="color:#BD93F9">pid</span><span style="color:#F8F8F2">;</span></span>
<span class="line"></span></code></pre>
<h3 id="pg_stat_database">pg_stat_database</h3>
<p>This view provides general database-level statistics such as the number of connections, committed transactions, rollbacks, and more. It is useful for understanding the overall health and workload on your database. Example usage:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#FF79C6">SELECT</span><span style="color:#F8F8F2"> datname, numbackends, xact_commit, xact_rollback, tup_inserted, tup_updated, tup_deleted </span></span>
<span class="line"><span style="color:#FF79C6">FROM</span><span style="color:#F8F8F2"> pg_stat_database;</span></span>
<span class="line"></span></code></pre>
<p>These are just a few of the many system views available in PostgreSQL. By leveraging these views and their insights into database performance, you can diagnose and solve a variety of issues related to your database system. Be sure to consult the <a href="https://www.postgresql.org/docs/current/monitoring-stats.html" rel="noopener noreferrer nofollow" target="_blank">official PostgreSQL documentation</a> for an exhaustive list of system views and their descriptions.</p>