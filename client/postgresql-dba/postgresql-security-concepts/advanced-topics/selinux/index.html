<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/postgresql-dba/content/106-postgresql-security-concepts/101-advanced-topics/101-selinux.md"></div> <h1 id="selinux">SELinux</h1>
<p>SELinux, or Security-Enhanced Linux, is a Linux kernel security module that brings heightened access control and security policies to your system. It is specifically designed to protect your system from unauthorized access and data leaks by enforcing a strict security policy, preventing processes from accessing resources they shouldnâ€™t, which is a significant tool for database administrators to help secure PostgreSQL instances.</p>
<h2 id="selinux-basics">SELinux Basics</h2>
<p>At its core, SELinux operates based on three main components:</p>
<ul>
<li><strong>User</strong>: in the context of SELinux, the user is an SELinux user identity that is mapped to a Linux user account.</li>
<li><strong>Role</strong>: an intermediary component that bridges SELinux users and SELinux domain, providing access control for transitioning between domain permissions.</li>
<li><strong>Domain</strong>: represents a specific set of permissions in SELinux that processes and resources can be associated with.</li>
</ul>
<p>The most important aspect of SELinux is its <strong>Type Enforcement</strong>. Types are associated with different resources such as files, directories, and processes. SELinux then enforces a strict policy based on types to ensure that only authorized processes can access specific resources.</p>
<h2 id="selinux-and-postgresql">SELinux and PostgreSQL</h2>
<p>When SELinux is enabled on your system, each process, including PostgreSQL, will be confined within its security domain. The PostgreSQL domain in SELinux is usually named <code>postgresql_t</code>.</p>
<p>To confine the PostgreSQL process within SELinux domain, you must specify the correct file contexts for PostgreSQL data and configuration files. Generally, the following file contexts are used:</p>
<ul>
<li><code>postgresql_conf_t</code> for the configuration files like <code>postgresql.conf</code> and <code>pg_hba.conf</code>.</li>
<li><code>postgresql_exec_t</code> for the executable binary files.</li>
<li><code>postgresql_var_run_t</code> for the runtime files like PID files.</li>
<li><code>postgresql_log_t</code> for the log files.</li>
<li><code>postgresql_db_t</code> for the database files.</li>
</ul>
<p>By setting the appropriate file contexts and ensuring proper domain permissions, you ensure that the PostgreSQL instance is protected by the security features provided by SELinux.</p>
<h2 id="managing-selinux-and-postgresql">Managing SELinux and PostgreSQL</h2>
<p>To effectively manage SELinux and PostgreSQL, use the following tools and command-line utilities:</p>
<ul>
<li><code>semanage</code>: Manage SELinux policies and configurations.</li>
<li><code>restorecon</code>: Reset the file context of an object to its default according to the policy.</li>
<li><code>chcon</code>: Modify the file context of an object.</li>
<li><code>sestatus</code>: Display the current status of SELinux on your system.</li>
</ul>
<p>For example, if you want to allow PostgreSQL to bind to a different port, you can use <code>semanage</code> to modify the port policy:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">sudo</span><span style="color:#F1FA8C"> semanage</span><span style="color:#F1FA8C"> port</span><span style="color:#BD93F9"> -a</span><span style="color:#BD93F9"> -t</span><span style="color:#F1FA8C"> postgresql_port_t</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> tcp</span><span style="color:#F1FA8C"> NEW_PORT_NUMBER</span></span>
<span class="line"></span></code></pre>
<p>And if you want to reset the file context after changing the PostgreSQL data directory location, you can use <code>restorecon</code>:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">sudo</span><span style="color:#F1FA8C"> restorecon</span><span style="color:#BD93F9"> -Rv</span><span style="color:#F1FA8C"> /path/to/new/pgdata</span></span>
<span class="line"></span></code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>SELinux provides enhanced security and access control features to protect your system, including PostgreSQL instances. By understanding the basics of SELinux, managing SELinux policies, and configuring file contexts, you can effectively secure your PostgreSQL instance on a system with SELinux enabled.</p>