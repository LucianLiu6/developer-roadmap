<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/postgresql-dba/content/107-postgresql-infrastructure-skills/100-replication/100-logical-replication.md"></div> <h1 id="logical-replication">Logical Replication</h1>
<p>Logical replication is a method of replicating data and database objects like tables or even specific table rows, so that the changes made in one database are reflected in another one. It provides more flexibility and granularity than physical replication, which replicates the entire database cluster.</p>
<h2 id="advantages-of-logical-replication">Advantages of Logical Replication</h2>
<ul>
<li><strong>Selective replication</strong>: You can choose specific tables or even rows within tables to replicate.</li>
<li><strong>Different schema versions</strong>: With logical replication, it is possible to have slightly different schemas between the source and target database, allowing you to maintain different versions of your application with minimal downtime and data inconsistency.</li>
<li><strong>Cross-version compatibility</strong>: Logical replication can work across different major versions of PostgreSQL, enabling smoother upgrading processes.</li>
</ul>
<h2 id="components-of-logical-replication">Components of Logical Replication</h2>
<ul>
<li>
<p><strong>Publication</strong>: It is a set of changes generated by a publisher in one database, which can be sent to one or more subscribers. You can create a publication on a specific table, multiple tables, or even on all tables within a database.</p>
</li>
<li>
<p><strong>Subscription</strong>: It represents the receiving end of a publication, i.e., the database that receives and applies the changes from a publisher. A subscription can be associated with one or more publications.</p>
</li>
</ul>
<h2 id="setting-up-logical-replication">Setting Up Logical Replication</h2>
<p>To set up logical replication, follow these steps:</p>
<ul>
<li>
<p>Enable logical replication by adding <code>wal_level = logical</code> and <code>max_replication_slots = &#x3C;number_of_slots></code> in the <code>postgresql.conf</code> file and restart the PostgreSQL instance.</p>
</li>
<li>
<p>Create a user for replication with the <code>REPLICATION</code> privilege:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>CREATE USER replicator WITH REPLICATION PASSWORD 'password';</span></span>
<span class="line"><span></span></span></code></pre>
</li>
<li>
<p>Grant access to the replication user by adding the following line to the <code>pg_hba.conf</code> file and reload the configuration:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>host replication replicator &#x3C;ip_address> md5</span></span>
<span class="line"><span></span></span></code></pre>
</li>
<li>
<p>On the publisher side, create a publication by specifying the tables you want to publish:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#FF79C6">CREATE</span><span style="color:#F8F8F2"> PUBLICATION my_publication </span><span style="color:#FF79C6">FOR</span><span style="color:#FF79C6"> TABLE</span><span style="color:#F8F8F2"> table1, table2;</span></span>
<span class="line"></span></code></pre>
</li>
<li>
<p>On the subscriber side, create a subscription by specifying the connection information and the publication to subscribe to:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#FF79C6">CREATE</span><span style="color:#F8F8F2"> SUBSCRIPTION my_subscription </span><span style="color:#FF79C6">CONNECTION</span><span style="color:#E9F284"> '</span><span style="color:#F1FA8C">host=ip_address dbname=db_name user=replicator password=password</span><span style="color:#E9F284">'</span><span style="color:#F8F8F2"> PUBLICATION my_publication;</span></span>
<span class="line"></span></code></pre>
</li>
</ul>
<p>After setting up the subscription, the data from the publisher will automatically synchronize to the subscriber.</p>
<p>Remember that logical replication might require additional maintenance and monitoring efforts, since it doesnâ€™t synchronize indexes, constraints, or stored procedures. You need to create those objects manually on the subscriber side if needed.</p>
<p>Now that you have an understanding of logical replication, you can use it to improve the performance, flexibility, and fault tolerance of your PostgreSQL databases.</p>