<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/postgresql-dba/content/107-postgresql-infrastructure-skills/102-backup-recovery-tools/100-barman.md"></div> <h1 id="barman-backup-and-recovery-manager">Barman (Backup and Recovery Manager)</h1>
<p>Barman, also known as Backup and Recovery Manager, is a popular open-source tool used for managing the backup, recovery and disaster recovery of PostgreSQL databases. It provides a simple command-line interface and lets you automate and centrally manage the process of taking backups of PostgreSQL instances. Barman is written in Python and is supported by EnterpriseDB, a leading PostgreSQL company.</p>
<h2 id="features">Features</h2>
<ul>
<li><strong>Remote Backup:</strong> Allows performing whole or incremental backups of remote PostgreSQL databases using an SSH connection.</li>
<li><strong>Point-in-time Recovery:</strong> Supports recovery to a specific point in time, giving the flexibility to restore data according to the needs.</li>
<li><strong>Retention Policies:</strong> Automatically enforces backup retention policies, allowing dataset optimization for backup storage.</li>
<li><strong>Data Compression and Streaming:</strong> Offers configurable data compression and streaming of backup files, saving storage space and time.</li>
<li><strong>Continuous Archiving:</strong> Allows continuous archiving of Write Ahead Log (WAL) files, essential for failover and recovery scenarios.</li>
<li><strong>Data Verification and Validation:</strong> Verifies and validates backups to ensure a safe and consistent recovery process.</li>
<li><strong>Monitoring and Reporting:</strong> Provides integrated monitoring and reporting features to have better control and visibility over backup management.</li>
</ul>
<h2 id="installation-and-configuration">Installation and Configuration</h2>
<p>To install Barman, you can use <code>pip</code>, the Python package manager:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">pip</span><span style="color:#F1FA8C"> install</span><span style="color:#F1FA8C"> barman</span></span>
<span class="line"></span></code></pre>
<p>After installation, create a dedicated <code>barman</code> user and a configuration file:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>sudo adduser barman</span></span>
<span class="line"><span>sudo mkdir /etc/barman.d</span></span>
<span class="line"><span>sudo chown -R barman:barman /etc/barman.d</span></span>
<span class="line"><span></span></span></code></pre>
<p>Create a <code>barman.conf</code> configuration file in the <code>/etc/barman.d</code> directory:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">sudo</span><span style="color:#F1FA8C"> vi</span><span style="color:#F1FA8C"> /etc/barman.d/barman.conf</span></span>
<span class="line"></span></code></pre>
<p>Add the following sample configuration to configure Barman for a PostgreSQL server:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>[barman]</span></span>
<span class="line"><span>barman_user = barman</span></span>
<span class="line"><span>configuration_files_directory = /etc/barman.d</span></span>
<span class="line"><span>barman_home = /var/lib/barman</span></span>
<span class="line"><span>log_file = /var/log/barman/barman.log</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[my_pg_server]</span></span>
<span class="line"><span>description = "My PostgreSQL Server"</span></span>
<span class="line"><span>conninfo = host=my_pg_server user=postgres dbname=my_dbname</span></span>
<span class="line"><span>streaming_conninfo = host=my_pg_server user=streaming_barman dbname=my_dbname</span></span>
<span class="line"><span>backup_method = postgres</span></span>
<span class="line"><span>wal_level = replica</span></span>
<span class="line"><span>streaming_archiver = on</span></span>
<span class="line"><span>slot_name = barman</span></span>
<span class="line"><span></span></span></code></pre>
<p>Replace <code>my_pg_server</code>, <code>my_dbname</code>, and other necessary details to match your PostgreSQL server.</p>
<h2 id="usage">Usage</h2>
<p>Perform a baseline backup using the following command:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">barman</span><span style="color:#F1FA8C"> backup</span><span style="color:#F1FA8C"> my_pg_server</span></span>
<span class="line"></span></code></pre>
<p>To recover your PostgreSQL instance, use the <code>barman recover</code> command:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">barman</span><span style="color:#F1FA8C"> recover</span><span style="color:#BD93F9"> --target-time</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">2021-11-23 12:00:00</span><span style="color:#E9F284">"</span><span style="color:#F1FA8C"> my_pg_server</span><span style="color:#F1FA8C"> latest</span><span style="color:#F1FA8C"> /path/to/recovery</span></span>
<span class="line"></span></code></pre>
<p>To list all backups, use:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">barman</span><span style="color:#F1FA8C"> list-backup</span><span style="color:#F1FA8C"> my_pg_server</span></span>
<span class="line"></span></code></pre>
<p>For more help, consult the Barman documentation or use <code>barman --help</code>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Barman is a powerful and feature-rich backup recovery tool for PostgreSQL, suitable for various business and production environments. Its capabilities of taking remote backups, enforcing retention policies, performing point-in-time recovery, and offering monitoring features make it an indispensable tool for managing PostgreSQL databases.</p>