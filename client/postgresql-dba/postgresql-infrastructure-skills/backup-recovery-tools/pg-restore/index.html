<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/postgresql-dba/content/107-postgresql-infrastructure-skills/102-backup-recovery-tools/106-pg-restore.md"></div> <h1 id="pg_restore">pg_restore</h1>
<p><code>pg_restore</code> is a powerful recovery tool in PostgreSQL, specifically designed to restore data and objects from a database backup created by the <code>pg_dump</code> utility. This command only works with backups in the <code>custom</code>, <code>directory</code>, and <code>tar</code> formats. It cannot restore backups in plain-text format, which are typically created using the <code>-Fp</code> option with <code>pg_dump</code>.</p>
<p><code>pg_restore</code> can handle numerous scenarios, such as:</p>
<ul>
<li>Restoring a full database backup</li>
<li>Selectively recovering specific database objects (tables, indexes, functions, etc.)</li>
<li>Remapping database object names or owners</li>
<li>Restoring to a different database server</li>
</ul>
<h2 id="using-pg_restore">Using pg_restore</h2>
<p>The basic usage of <code>pg_restore</code> is as follows:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">pg_restore</span><span style="color:#F8F8F2"> [options] [backup_file]</span></span>
<span class="line"></span></code></pre>
<p>Here’s an example of restoring a full database backup:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#50FA7B">pg_restore</span><span style="color:#BD93F9"> -U</span><span style="color:#F1FA8C"> username</span><span style="color:#BD93F9"> -W</span><span style="color:#BD93F9"> -h</span><span style="color:#F1FA8C"> host</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> port</span><span style="color:#BD93F9"> -Ft</span><span style="color:#BD93F9"> -C</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dbname</span><span style="color:#F1FA8C"> backup_file.tar</span></span>
<span class="line"></span></code></pre>
<p>In this example:</p>
<ul>
<li><code>-U</code> specifies the user to connect as.</li>
<li><code>-W</code> prompts for the password.</li>
<li><code>-h</code> and <code>-p</code> specify the host and port, respectively.</li>
<li><code>-Ft</code> indicates the file format (<code>t</code> for tar).</li>
<li><code>-C</code> creates a new database before performing the restore.</li>
<li><code>-d</code> specifies the target database.</li>
</ul>
<h2 id="selective-restore">Selective Restore</h2>
<p><code>pg_restore</code> allows you to selectively restore specific database objects. You need to use the <code>-L</code> option followed by the list of desired objects.</p>
<p>To generate a list of objects in a backup file, use the <code>-l</code> option:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#50FA7B">pg_restore</span><span style="color:#BD93F9"> -l</span><span style="color:#F1FA8C"> backup_file.tar</span><span style="color:#FF79C6"> ></span><span style="color:#F1FA8C"> object_list.txt</span></span>
<span class="line"></span></code></pre>
<p>Edit the <code>object_list.txt</code> file to keep only the objects you’d like to restore, and then use the following command:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#50FA7B">pg_restore</span><span style="color:#BD93F9"> -U</span><span style="color:#F1FA8C"> username</span><span style="color:#BD93F9"> -W</span><span style="color:#BD93F9"> -h</span><span style="color:#F1FA8C"> host</span><span style="color:#BD93F9"> -p</span><span style="color:#F1FA8C"> port</span><span style="color:#BD93F9"> -Ft</span><span style="color:#BD93F9"> -d</span><span style="color:#F1FA8C"> dbname</span><span style="color:#BD93F9"> -L</span><span style="color:#F1FA8C"> object_list.txt</span><span style="color:#F1FA8C"> backup_file.tar</span></span>
<span class="line"></span></code></pre>
<h2 id="remapping-object-names-and-owners">Remapping Object Names and Owners</h2>
<p><code>pg_restore</code> can also remap object names and owners using the <code>--tablespace-mapping</code>, <code>--role-mapping</code>, and other options. For more information, consult the <a href="https://www.postgresql.org/docs/current/app-pgrestore.html" rel="noopener noreferrer nofollow" target="_blank">official PostgreSQL documentation</a>.</p>
<h2 id="summary">Summary</h2>
<p><code>pg_restore</code> is an essential tool for recovering data from PostgreSQL backups created by <code>pg_dump</code>. It offers flexible options for restoring full backups, selecting objects to recover, and remapping object names and owners.</p>