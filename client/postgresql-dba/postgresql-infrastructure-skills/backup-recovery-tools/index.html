<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/postgresql-dba/content/107-postgresql-infrastructure-skills/102-backup-recovery-tools/index.md"></div> <h1 id="backup-recovery-tools-in-postgresql">Backup Recovery Tools in PostgreSQL</h1>
<p>Backup recovery tools are essential to ensure data safety and minimize data loss in the event of hardware and/or software failure or any other disaster. In this topic, we will discuss the most commonly used backup recovery tools in PostgreSQL.</p>
<h2 id="pg_dump-and-pg_restore">pg_dump and pg_restore</h2>
<p><code>pg_dump</code> is a utility provided by PostgreSQL to create a backup of a single database. It generates a SQL file or a custom-format archive that contains the data and schema of the specified database. The command syntax is as follows:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">pg_dump</span><span style="color:#BD93F9"> --host</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">hostnam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --port</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">por</span><span style="color:#F8F8F2">t</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --username</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">usernam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --password</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">passwor</span><span style="color:#F8F8F2">d</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --file</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">output-fil</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">databas</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span></span>
<span class="line"></span></code></pre>
<p>After creating a backup with <code>pg_dump</code>, you can use the <code>pg_restore</code> tool to restore the database from the generated SQL file or custom-format archive. The command syntax is as follows:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">pg_restore</span><span style="color:#BD93F9"> --host</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">hostnam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --port</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">por</span><span style="color:#F8F8F2">t</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --username</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">usernam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --password</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">passwor</span><span style="color:#F8F8F2">d</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --dbname</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">databas</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">input-fil</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span></span>
<span class="line"></span></code></pre>
<h2 id="pg_basebackup">pg_basebackup</h2>
<p><code>pg_basebackup</code> is a utility that creates a binary copy (base backup) of an entire PostgreSQL cluster, including all data files, tablespaces, and configuration files. The base backup can be used as a starting point for setting up a new replica or to restore the cluster during a disaster. The command syntax is as follows:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#50FA7B">pg_basebackup</span><span style="color:#BD93F9"> --host</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">hostnam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --port</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">por</span><span style="color:#F8F8F2">t</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --username</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">usernam</span><span style="color:#F8F8F2">e</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --password</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">passwor</span><span style="color:#F8F8F2">d</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --directory</span><span style="color:#FF79C6"> &#x3C;</span><span style="color:#F1FA8C">output-director</span><span style="color:#F8F8F2">y</span><span style="color:#FF79C6">></span><span style="color:#BD93F9"> --progress</span><span style="color:#BD93F9"> --verbose</span></span>
<span class="line"></span></code></pre>
<p>The <code>--progress</code> flag is optional and displays a progress report, while the <code>--verbose</code> flag increases information messages.</p>
<h2 id="continuous-archiving-and-point-in-time-recovery-pitr">Continuous Archiving and Point-in-Time Recovery (PITR)</h2>
<p>Apart from backing up the entire database, PostgreSQL also allows continuous archiving of the write-ahead log (WAL) files. This technique, combined with the base backup, helps in recovering data up to a specific point in time.</p>
<p>To enable continuous archiving, you need to modify the <code>postgresql.conf</code> file and set the <code>wal_level</code> to <code>replica</code>, <code>archive_mode</code> to <code>on</code>, and configure <code>archive_command</code>. For example:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>wal_level = replica</span></span>
<span class="line"><span>archive_mode = on</span></span>
<span class="line"><span>archive_command = 'cp %p /path/to/archive/%f'</span></span>
<span class="line"><span></span></span></code></pre>
<p>The <code>archive_command</code> is a shell command used for archiving the WAL files, and <code>%p</code> and <code>%f</code> are placeholders for the file path and file name, respectively.</p>
<p>Point-in-Time Recovery (PITR) can be performed by configuring the <code>recovery.conf</code> file in the data directory of the PostgreSQL instance. It includes setting the <code>restore_command</code>, which is a shell command for restoring WAL files. An example configuration:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>restore_command = 'cp /path/to/archive/%f %p'</span></span>
<span class="line"><span>recovery_target_time = '2021-12-31 23:59:59'</span></span>
<span class="line"><span></span></span></code></pre>
<p>In the configuration above, the <code>recovery_target_time</code> specifies the exact time up to which the database should be recovered.</p>
<h2 id="conclusion">Conclusion</h2>
<p>In this topic, we have discussed the most commonly used backup recovery tools in PostgreSQL such as <code>pg_dump</code>, <code>pg_restore</code>, <code>pg_basebackup</code>, and continuous archiving with PITR. These tools help to ensure data safety in PostgreSQL by providing various backup and recovery options. It is crucial to have a proper backup strategy in place to handle unforeseen circumstances and ensure minimal data loss.</p>