<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/cpp/content/112-idioms/105-copy-swap.md"></div> <h1 id="copy-and-swap">Copy and Swap</h1>
<p>Copy-swap is a C++ idiom that leverages the copy constructor and swap function to create an assignment operator. It follows a simple, yet powerful paradigm: create a temporary copy of the right-hand side object, and swap its contents with the left-hand side object.</p>
<p>Here’s a brief summary:</p>
<ul>
<li><strong>Copy</strong>: Create a local copy of the right-hand side object. This step leverages the copy constructor, providing exception safety and code reuse.</li>
<li><strong>Swap</strong>: Swap the contents of the left-hand side object with the temporary copy. This step typically involves swapping internal pointers or resources, without needing to copy the full contents again.</li>
<li><strong>Destruction</strong>: Destroy the temporary copy. This happens upon the exit of the assignment operator.</li>
</ul>
<p>Here’s a code example for a simple <code>String</code> class:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> String</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#6272A4">    // ... rest of the class ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#50FA7B">    String</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">const</span><span style="color:#8BE9FD;font-style:italic"> String</span><span style="color:#FF79C6">&#x26;</span><span style="color:#FFB86C;font-style:italic"> other</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">    </span></span>
<span class="line"><span style="color:#FF79C6">    friend</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> swap</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#FF79C6">&#x26;</span><span style="color:#FFB86C;font-style:italic"> first</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#FF79C6">&#x26;</span><span style="color:#FFB86C;font-style:italic"> second</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">        using</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">swap;</span><span style="color:#6272A4"> // for arguments-dependent lookup (ADL)</span></span>
<span class="line"><span style="color:#50FA7B">        swap</span><span style="color:#F8F8F2">(first.size_, second.size_);</span></span>
<span class="line"><span style="color:#50FA7B">        swap</span><span style="color:#F8F8F2">(first.buffer_, second.buffer_);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">    String</span><span style="color:#FF79C6">&#x26;</span><span style="color:#FF79C6"> operator</span><span style="color:#F8F8F2">=(</span><span style="color:#8BE9FD;font-style:italic">String</span><span style="color:#FFB86C;font-style:italic"> other</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#50FA7B">        swap</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">*</span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">, other);</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#FF79C6"> *</span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">};</span></span>
<span class="line"></span></code></pre>
<p>Using the copy-swap idiom:</p>
<ul>
<li>The right-hand side object is copied when passed by value to the assignment operator.</li>
<li>The left-hand side object’s contents are swapped with the temporary copy.</li>
<li>The temporary copy is destroyed, releasing any resources that were previously held by the left-hand side object.</li>
</ul>
<p>This approach simplifies the implementation and provides strong exception safety, while reusing the copy constructor and destructor code.</p>