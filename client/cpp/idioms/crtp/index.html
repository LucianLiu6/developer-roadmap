<div data-github-url="https://github.com/kamranahmedse/developer-roadmap/tree/master/src/data/roadmaps/cpp/content/112-idioms/102-crtp.md"></div> <h1 id="crtp">CRTP</h1>
<p><strong>Curiously Recurring Template Pattern (CRTP)</strong></p>
<p>The Curiously Recurring Template Pattern (CRTP) is a C++ idiom that involves a class template being derived from its own specialization. This pattern allows for the creation of static polymorphism, which differs from regular runtime polymorphism that relies on virtual functions and inheritance.</p>
<p>CRTP is usually employed when you want to customize certain behavior in the base class without adding the overhead of a virtual function call. In short, CRTP can be used for achieving compile-time polymorphism without the runtime performance cost.</p>
<p>Here’s an example demonstrating CRTP:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#FF79C6">template</span><span style="color:#F8F8F2"> &#x3C;</span><span style="color:#FF79C6">typename</span><span style="color:#8BE9FD;font-style:italic"> Derived</span><span style="color:#F8F8F2">></span></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> Base</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">public:</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> interface</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#FF79C6">        static_cast&#x3C;</span><span style="color:#F8F8F2">Derived</span><span style="color:#FF79C6">*></span><span style="color:#F8F8F2">(</span><span style="color:#BD93F9;font-style:italic">this</span><span style="color:#F8F8F2">)</span><span style="color:#FF79C6">-></span><span style="color:#50FA7B">implementation</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> implementation</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#F8F8F2">        std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">cout </span><span style="color:#FF79C6">&#x3C;&#x3C;</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">Default implementation in Base</span><span style="color:#E9F284">"</span><span style="color:#FF79C6"> &#x3C;&#x3C;</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">endl;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> Derived1</span><span style="color:#F8F8F2"> : </span><span style="color:#FF79C6">public</span><span style="color:#8BE9FD;font-style:italic"> Base</span><span style="color:#F8F8F2">&#x3C;</span><span style="color:#8BE9FD;font-style:italic">Derived1</span><span style="color:#F8F8F2">> {</span></span>
<span class="line"><span style="color:#FF79C6">public:</span></span>
<span class="line"><span style="color:#FF79C6">    void</span><span style="color:#50FA7B"> implementation</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#F8F8F2">        std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">cout </span><span style="color:#FF79C6">&#x3C;&#x3C;</span><span style="color:#E9F284"> "</span><span style="color:#F1FA8C">Custom implementation in Derived1</span><span style="color:#E9F284">"</span><span style="color:#FF79C6"> &#x3C;&#x3C;</span><span style="color:#F8F8F2"> std</span><span style="color:#FF79C6">::</span><span style="color:#F8F8F2">endl;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">class</span><span style="color:#8BE9FD"> Derived2</span><span style="color:#F8F8F2"> : </span><span style="color:#FF79C6">public</span><span style="color:#8BE9FD;font-style:italic"> Base</span><span style="color:#F8F8F2">&#x3C;</span><span style="color:#8BE9FD;font-style:italic">Derived2</span><span style="color:#F8F8F2">> {</span></span>
<span class="line"><span style="color:#6272A4">    // No custom implementation, so Base::implementation will be used.</span></span>
<span class="line"><span style="color:#F8F8F2">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">int</span><span style="color:#50FA7B"> main</span><span style="color:#F8F8F2">() {</span></span>
<span class="line"><span style="color:#F8F8F2">    Derived1 d1;</span></span>
<span class="line"><span style="color:#F8F8F2">    d1.</span><span style="color:#50FA7B">interface</span><span style="color:#F8F8F2">();</span><span style="color:#6272A4">  // Output: "Custom implementation in Derived1"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    Derived2 d2;</span></span>
<span class="line"><span style="color:#F8F8F2">    d2.</span><span style="color:#50FA7B">interface</span><span style="color:#F8F8F2">();</span><span style="color:#6272A4">  // Output: "Default implementation in Base"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    return</span><span style="color:#BD93F9"> 0</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"></span></code></pre>
<p>In this example, the <code>Base</code> class is a template that takes a single type parameter. <code>Derived1</code> and <code>Derived2</code> are derived from their respective specialization of <code>Base</code>. CRTP is employed to allow custom implementations of the <code>implementation()</code> function in derived classes while providing a default behavior in the <code>Base</code> class. The <code>interface()</code> function in the <code>Base</code> class is a template for the derived class’s behavior and calls the corresponding <code>implementation()</code> function based on the static type.</p>
<p>This pattern enables you to override certain behavior in derived classes with additional functionality, all while avoiding the overhead of virtual function calls and, in turn, achieving a higher degree of efficiency at runtime.</p>